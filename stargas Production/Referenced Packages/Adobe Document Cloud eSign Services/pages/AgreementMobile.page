<apex:page cache="true" 
           expires="600"
           docType="html-5.0"
           showHeader="false" 
           sidebar="false"
           standardStylesheets="false"
           standardController="echosign_dev1__SIGN_Agreement__c"
           extensions="echosign_dev1.AgreementMobileController">           
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"/>
                                  
        <!-- <meta content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport"/>
        <meta media="(device-height: 568px)" content="initial-scale=1.0,user-scalable=no,maximum-scale=1" name="viewport" id="vp"/>
        <meta content="yes" name="apple-mobile-web-app-capable"/>
        <meta content="telephone=no" name="format-detection"/> -->
                                  
        <apex:stylesheet value="{!URLFOR($Resource.Mobile_Design_Templates, 
                'Mobile-Design-Templates-master/common/css/app.min.css')}"/>
        <apex:includeScript value="{!URLFOR($Resource.Mobile_Design_Templates, 
                'Mobile-Design-Templates-master/common/js/jQuery2.0.2.min.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.Mobile_Design_Templates, 
                'Mobile-Design-Templates-master/common/js/jquery.touchwipe.min.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.Mobile_Design_Templates, 
                'Mobile-Design-Templates-master/common/js/main.min.js')}"/>
        <apex:includeScript value="{!$Resource.echosign_dev1__underscore_1_5_1}"/> 
    <apex:includeScript value="{!$Resource.echosign_dev1__path_js}"/>
    <apex:includeScript value="{!$Resource.echosign_dev1__classcreate}"/>
    <apex:includeScript value="{!$Resource.echosign_dev1__queryencoder010}"/>
    
    <apex:stylesheet value="{!URLFOR($Resource.echosign_dev1__OneStarter,'icons.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.echosign_dev1__OneStarter,'styles.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.echosign_dev1__OneStarter,'OneStarter.css')}"/>   
    <!-- <apex:includeScript value="{!URLFOR($Resource.OneStarter,'jquery.onestarter.js')}"/>  -->
    <!-- <apex:includeScript value="/canvas/sdk/js/publisher.js"/>  -->
    
    <style type="text/css">
        .overlay {
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 998;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 110%;
            display: none;
        }

        .buttons-overlay {
            display: none; 
            /*width: 90%; margin-left: 5%;*/ 
            z-index: 999; 
            position: absolute; 
            padding-left: 35%; 
            /*padding-right: 30%;*/
            padding-top: 90%;
        }
        
        .icon--pdf {
            background-image: url("{!URLFOR($Resource.s1doctype,'s1doctypes/pdf_120.png')}");
            background-size: cover;
            height: 37px;
        }
        
        .icon--word {
            background-image: url("{!URLFOR($Resource.s1doctype,'s1doctypes/word_120.png')}");
            background-size: cover;
            height: 37px;
        }
        
        .icon--ppt {
            background-image: url("{!URLFOR($Resource.s1doctype,'s1doctypes/ppt_120.png')}");
            background-size: cover;
            height: 37px;
        }
        
        .icon--excel {
            background-image: url("{!URLFOR($Resource.s1doctype,'s1doctypes/excel_120.png')}");
            background-size: cover;
            height: 37px;
        }
        
        .icon--image {
            background-image: url("{!URLFOR($Resource.s1doctype,'s1doctypes/image_120.png')}");
            background-size: cover;
            height: 37px;
        }
        
        .icon--template {
            background-image: url("{!$Resource.LibraryDocumentTemplate}");
             height: 18px;
        }
        
        .icon--layer {
            background-image: url("{!$Resource.LibraryFieldsTemplate}");
        }
        
        .es-agreement-header-panel {
            padding-bottom: 30px;
        }               

        .es-agreement-header-panel-phone {
            padding-bottom: 70px;
        }
        
        .es-loading-section {
            padding-top: 20%;
        }
        
        .es-input-value {
            padding-top: 10px;
        }
        
        .es-input-label {
            padding-left: 0px;
            width: 100%;
        }
        
        .es-lookup-link {
            color: rgb(150, 152, 153);
            font-size: 15px;
            height: 44px;
            line-height: 48px;
            position: absolute;
            right: 0;
            text-align: center;
            width: 44px;
            text-decoration: none;
            
        }
        
        .es-lookup-icon {
            font-family: 'MyWebFont';
            /* content: attr(data-icon); */
            /* speak: none; */
            background-image: url({!URLFOR($Resource.s1fonts,'s1fonts/fonts/icon-utility.svg')});
            text-rendering: optimizeLegibility;
            font-weight: normal;
            font-variant: normal;
            text-transform: none;
            line-height: 1;
            -webkit-font-smoothing: antialiased;
            color: rgb(150, 152, 153);
            font-size: 15px;
            line-height: 48px;
            text-align: center;
        }
        
        .es-tab-item-title {
            font-weight: 500;
            font-size: 17px;
            color: rgb(105, 110, 113);
            -webkit-font-smoothing: antialiased;
        }
        
        .es-tab-item-subtitle {  
            padding-left: 40px;         
            font-size: 14px;
            color: rgb(105, 110, 113);
            -webkit-font-smoothing: antialiased;
        }   
            
        .es-tab-header-button-label {
            font-size: 16px;
            color: rgb(68, 89, 108);
            text-shadow: none;
            font-weight: bold;
        }
        
        .es-tab-header-button {
            margin-left: -40px;
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
            border-right-width: 1px;
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
            padding: 4px 14px;
            height: 35px;
            font-size: 16px;
            font-weight: normal;
            border: 1px solid rgb(187, 192, 196);
            background: linear-gradient(rgb(255, 255, 255),rgb(241, 241, 241));
            box-shadow: none;
            text-decoration: none;
            text-align: center;
        }
        
        .es-tab-header-icon {
            width: 30px;
            margin-top: 15px;
            margin-left: 15px;
            height: 30px;
            border-radius: 3px;
        }
        
        .es-tab-header-title {
            vertical-align: super;
            text-align: left;
            font-family: ProximaNova, Arial, sans-serif;
            font-weight: 500;
            padding-left: 5px;
            font-size: 18px;
            color: rgb(105, 110, 113);
            -webkit-font-smoothing: antialiased;
        }
        
        .es-tab-header {
            background-color: rgb(255, 255, 255);
            border-bottom: 1px solid rgb(207, 212, 217);
            border-bottom-width: 1px;
            border-bottom-style: solid;
            border-bottom-color: rgb(207, 212, 217);
        }  
            
        .es-subbutton-label {
            font-size: 16px;
            color: rgb(68, 89, 108);
            text-shadow: none;
            font-weight: bold;
        }
                
        .es-subbutton {
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
            border-right-width: 1px;
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
            padding: 4px 14px;
            height: 35px;
            font-size: 16px;
            font-weight: normal;
            border: 1px solid rgb(187, 192, 196);
            background: linear-gradient(rgb(255, 255, 255),rgb(241, 241, 241));
            box-shadow: none;
            text-decoration: none;
            text-align: center;
        }
        
        .es-button {
            border-color: rgb(28, 120, 177);
            border-width: 1px;
            border-style: solid;
            border-radius: 5px;
            width: 15%;
            font-weight: 700;
            font-size: 16px;
            border-radius: 5px;
            background-color: rgb(63, 159, 217);
            background-image: -webkit-linear-gradient(top, rgb(63, 159, 217), rgb(39, 137, 199));
            color: rgb(255, 255, 255);
            -webkit-appearance: button;
            cursor: pointer;
            text-transform: none;
            line-height: normal;
            align-items: flex-start;
            text-align: center;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            font-family: ProximaNova, Arial, sans-serif;
            height: 40px;
        }
        
        .es-agreement-header-phone {
            background-color: #344A5F;
            height: 130px;
        }
        
        .es-agreement-header {
            background-color: #344A5F;
            height: 100px;
        }
        
        .es-section-header {
            padding-bottom: 10px;
        }
        
        .es-section-label {
            /*font-family: 'ProximaNovaSoft-Regular';*/
            font-size: 14px;
            color: rgb(105, 110, 113);
            -webkit-font-smoothing: antialiased;
        }
        
        .detail-view-header .detail-view-action-panel > a.es-action-remind {
            background-image: url({!URLFOR($Resource.s1custom,'s1custom/custom25_120.png')});
            background-color: #2A94D6;
        }
        
        .detail-view-header .detail-view-action-panel > a.es-action-view {
            background-image: url({!URLFOR($Resource.s1custom,'s1custom/custom39_120.png')});
            background-color: #4EB1CB;
        }
        
        .detail-view-header .detail-view-action-panel > a.es-action-remove {
            background-image: url({!URLFOR($Resource.s1custom,'s1custom/custom9_120.png')});
            background-color: #F3AE4E;
        }
                
        .content .status.status-orange{color:orange}
        .detail-view-header .content .status.status-orange .status-dot{background:orange}.detail-view-header
    </style>

<!-- iOS 8 issue workaround, delete once fixed - https://success.salesforce.com/issues_view?id=a1p30000000T5hOAAS -->    
<!-- <script> 
(function(){try{var a=navigator.userAgent; 
if((a.indexOf('Salesforce')!=-1)&&(a.indexOf('iPhone')!=-1||a.indexOf('iPad')!=-1)&&(a.indexOf('OS/8')!=-1||a.indexOf('OS 8')!=-1)&&(a.indexOf('Safari')==-1)){ 
var s=document.createElement('style'); 
s.innerHTML="html,html body{overflow: auto;-webkit-overflow-scrolling:touch;}body{position:absolute;left:0;right:0;top:0;bottom:0;}"; 
document.getElementsByTagName('head')[0].appendChild(s);}}catch(e){}})(); 
</script> --> 
   
       <script type="text/html" id='detailView'>
            <div class="app-wrapper">
                <div id="agreement-header-panel" style="display: none;" class="es-agreement-header-panel">
                    <header class="es-agreement-header">
                        <div>
                            <img style="height: 50px; border-radius: 3px; margin-top: 20px; margin-left: 2%;" src="{!$Resource.AgreementLogo}"/>
                        </div>
                        <div>
                            <div>
                                <h1>
                                    <span style="word-wrap:break-word;" id="agreement-name-header"><%= agreement.agreement.Name %></span><br/>
                                    <span><%= agreement.agreement[NAMESPACE_FULL + 'Status__c'] %></span>
                                </h1>
                            </div>
                        </div>
                    </header>
                </div>
                <div id="agreement-header-panel-phone" style="display: none;" class="es-agreement-header-panel-phone">
                    <header class="es-agreement-header-phone">
                        <div>

                            <div>
                                <h1>
                                    <img style="height: 50px; border-radius: 3px; margin-top: -20px;" src="{!$Resource.AgreementLogo}"/>
                                    <br/>
                                    <div>
                                        <span style="word-wrap:break-word;" id="agreement-name-header"><%= agreement.agreement.Name %></span><br/>
                                        <span><%= agreement.agreement[NAMESPACE_FULL + 'Status__c'] %></span>
                                    </div>
                                </h1>
                            </div>
                        </div>
                    </header>
                </div>

                <!-- <div class="app-content" id="viewAgreement" style="display: none; margin-top: 25px;">
<section id="closeButtonSection" class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px; padding-bottom: 10px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="closeViewAgreement();" class="es-subbutton"><span class="es-subbutton-label">Close</span></button>
        </li>
    </ul>
    </div>
</section>
                        <iframe id="viewAgreementFrame" style="margin-left: -5%" width="100%" height="500px" />
<section id="closeButtonSectionBottom" class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px; padding-bottom: 10px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="closeViewAgreement();" class="es-subbutton"><span class="es-subbutton-label">Close</span></button>
        </li>
    </ul>
    </div>
</section>
                </div> -->
                
                <div class="app-content" id="progressSpinner" style="display: none;" >
                    <div class="es-loading-section tc">
                        <img src="{!URLFOR($Resource.OneStarter,'assets/loading-gray.gif')}" alt="loading" class="sq-20 dib">
                    </div> 
                </div>   

                <!-- <div class="app-content" id="sendConfirmation" style="display: none;">
                    <section id="closeButtonSection" class="data-capture-buttons one-buttons">
                        <div class="content">
                            <button onclick="closeViewAgreement();" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 text-color-4 f3 fw-semibold">
                                Close
                            </button>
                        </div>
                    </section>
                    <iframe id="sendConfirmationFrame" style="padding-left: 5%;" width="95%" height="500px" />
                    <section id="closeButtonSectionBottom" class="data-capture-buttons one-buttons">
                        <div class="content">
                            <button onclick="closeViewAgreement();" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 text-color-4 f3 fw-semibold">
                                Close
                            </button>
                        </div>
                    </section>
                </div> -->   


<div id="overlay-pass" class="overlay">
<div id="pass-device-dialog" style="padding-top: 40%;" class="buttons-overlay">
<a style="display: none;" href="" name="close" title="close" class="db tr size-full pbm">
  <span class="db icon-utility-close f2 wht"></span>
</a>
<div id="pass-device-dialog-content" class="bg-1 brm pam pos-rel tc">
    <span class="text-color-4 f3 fw-semibold">Please pass the device to the signer.</span>
  <button style="margin-top: 20px;" id="pass-confirm-ok-button" autofocus="autofocus" onclick="showAffirmPassDialog();" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">OK</span>
  </button>
  <button onclick="hideConfirmPassDialog();" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2">
    <span class="text-color-4 f3 fw-semibold">Cancel</span>
  </button>
</div>
</div>
</div> 

<div id="logout-panel">
</div>

<div id="overlay-affirm" class="overlay">
<div id="affirm-signer-dialog" style="padding-top: 40%; width: 75%; padding-left: 35%;" class="buttons-overlay">
<a style="display: none;" href="" name="close" title="close" class="db tr size-full pbm">
  <span class="db icon-utility-close f2 wht"></span>
</a>
<div id="affirm-signer-dialog-content" class="bg-1 brm pam pos-rel tc">
    <span id="affirm-descr-span" style="word-wrap: break-word;" class="text-color-4 f3 fw-semibold"/>
  <button style="margin-top: 20px;" id="pass-affirm-ok-button" autofocus="autofocus" onclick="affirmSigner('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span id="affirm-yes-span" style="word-wrap: break-word;" class="text-color-4 f3 fw-semibold"/>
  </button>
  <button onclick="hideAffirmPassDialog();" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span id="affirm-no-span" style="word-wrap: break-word;" class="text-color-4 f3 fw-semibold"/>
  </button>
  <button onclick="hideAffirmPassDialog();" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2">
    <span class="text-color-4 f3 fw-semibold">Cancel</span>
  </button>
</div>
</div>
</div> 


<div id="overlay-signers" class="overlay">
<div id="choose-signers-dialog" style="padding-top: 40%;" class="buttons-overlay">
<a style="display: none;" href="" name="close" title="close" class="db tr size-full pbm">
  <span class="db icon-utility-close f2 wht"></span>
</a>
<div id="choose-signers-buttons-dialog" class="bg-1 brm pam pos-rel tc">
    <span class="text-color-4 f3 fw-semibold">Please choose which signer to host:</span>
</div>
</div>
</div> 

                <div class="app-content" id="viewAgreementContent">

<div class="detail-view-header with-action-panel">
    <div class="content">
        <div id="draftStatusBar" style="display: none;" class="status status-green">
            <div>
                <img height="35px" style="background-color: #4EB1CB; border-radius: 35px;" src="{!URLFOR($Resource.s1custom,'s1custom/custom18_60.png')}"/>
            </div>
            <span style="margin-top: 10px;" class="status-dot">&nbsp;</span><%= agreement.agreement[NAMESPACE_FULL + 'Status__c'] %>
        </div>
        <div id="inProgressStatusBar" style="display: none;" class="status status-orange">
            <div>
                <img height="35px" style="background-color: #4EB1CB; border-radius: 35px;" src="{!URLFOR($Resource.s1custom,'s1custom/custom26_60.png')}"/>
            </div>
            <span style="margin-top: 10px;" class="status-dot">&nbsp;</span><%= agreement.agreement[NAMESPACE_FULL + 'Status__c'] %>
        </div>
        <div id="successStatusBar" style="display: none;" class="status status-green">
            <div>
                <img height="35px" style="background-color: #4EB1CB; border-radius: 35px;" src="{!URLFOR($Resource.s1custom,'s1custom/custom14_60.png')}"/>
            </div>
            <span style="margin-top: 10px;" class="status-dot">&nbsp;</span><%= agreement.agreement[NAMESPACE_FULL + 'Status__c'] %>
        </div>
        <div id="failedStatusBar" style="display: none;" class="status status-red">
            <div>
                <img height="35px" style="background-color: #4EB1CB; border-radius: 35px;" src="{!URLFOR($Resource.s1custom,'s1custom/custom9_60.png')}"/>
            </div>
            <span style="margin-top: 10px;" class="status-dot">&nbsp;</span><%= agreement.agreement[NAMESPACE_FULL + 'Status__c'] %>
        </div>

    </div><!--.content-->
</div><!--.detail-view-header-->

<section class="data-capture-buttons one-buttons">
    <div id="es-buttons-top" style="display: none; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="hostedSignButton" style="display: none;" onclick="sendHostedAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Host Signing</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="sendReminderButton" onclick="sendReminder('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Remind</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="cancelAgreementButton" onclick="window.location.href = '#/agreement/cancel/<%= agreement.agreement.Id %>'" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="deleteAgreementButton" onclick="window.location.href = '#/agreement/remove/<%= agreement.agreement.Id %>'" class="es-subbutton"><span class="es-subbutton-label">Delete</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="viewAgreementButton" onclick="viewAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">View</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="updateAgreementButton" onclick="updateAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Update</span></button>
        </li>
    </ul>
    </div>
    <div id="es-buttons-phone-top" style="display: none; padding-top: 15px;">
<div style="background-color: inherit;" class="bg-1 brm pam pos-rel tc">
  <button id="hostedSignButtonPhone" style="display: none;" onclick="sendHostedAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Host Signing</span>
  </button>
  <button id="sendReminderButtonMobile" onclick="sendReminder('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Remind</span>
  </button>
  <button id="cancelAgreementButtonMobile" onclick="window.location.href = '#/agreement/cancel/<%= agreement.agreement.Id %>'" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Cancel</span>
  </button>
  <button id="deleteAgreementButtonMobile" onclick="window.location.href = '#/agreement/remove/<%= agreement.agreement.Id %>'" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Delete</span>
  </button>
  <button id="viewAgreementButtonMobile" onclick="viewAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">View</span>
  </button>
  <button id="updateAgreementButtonMobile" onclick="updateAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Update</span>
  </button>
</div>
    </div>
</section><!--.data-capture-buttons-->

<div class="app-content" style="display: none;" id="agreementInfoPanel">
<section class="bg-7 border-bottom border--3">
  <div class="flag">
    <div class="flag--image phm">
      <span class="text-info icon-utility-info"></span>
    </div>
    <div class="flag--body">
      <h1 class="mvm fw-semibold text-color-1 f4">
        Agreement Message
      </h1>
    </div>
  </div>
  <p id="agreementInfoMessage" class="mhm mtn f6 text-color-1">
  </p>
</section>
</div>

<div class="app-content" style="display: none;" id="agreementErrorPanel">
<section class="bg-7 border-bottom border--3">
  <div class="flag">
    <div class="flag--image phm">
      <span class="text-error icon-utility-error"></span>
    </div>
    <div class="flag--body">
      <h1 class="mvm fw-semibold text-color-1 f4">
        Agreement Error
      </h1>
    </div>
  </div>
  <p id="agreementErrorMessage" class="mhm mtn f6 text-color-1">
  </p>
</section>
</div>

<div>
<div style="padding-left: 5px; padding-right: 2px;">
<article id="recipients-view-content" class="mam bg-1 border border--3 brm">
  <ul id="recipients-view-list" class="man pan list-plain">
    <li class="pam border-bottom border--8">
      <div class="mbs flag flag--rev">
        <div style="width: 20px;" class="flag--body">
          <h1 class="fl man fw-normal f5 text-color-1">Recipients</h1>
        </div>
      </div>
    </li>
  </ul>
</article>
</div>
</div>

<section style="border-bottom-width: 0px;" class="border-bottom">
    <div class="content">
        <div class="es-section-header">
            <span class="es-section-label">Message</span>
        </div>
        <p>
            <span class="es-section-label"><%= agreement.agreement[NAMESPACE_FULL + 'Message__c'] %></span>
        </p>
    </div>
    <div class="content">
        <div class="es-section-header">
            <span class="es-section-label">Language</span>
        </div>
          <div class="form-control-group">
           <div class="form-control form-control-select">
            <span class="es-section-label"><%= agreement.agreement[NAMESPACE_FULL + 'AgreementLocale__c'] %></span>
           </div>
          </div>
    </div>
    <div class="content">
        <div class="es-section-header">
            <span class="es-section-label">Account</span>
        </div>
          <div class="form-control-group">
           <div class="form-control form-control-text">
            <% if (typeof(agreement.agreement[NAMESPACE_FULL + 'Account__c']) != "undefined") { %>
                <a style="vertical-align: super;" id="agreementAccount" href="javascript:sforce.one.navigateToSObject('<%= agreement.agreement[NAMESPACE_FULL + 'Account__c'] %>')"><%= agreement.agreement[NAMESPACE_FULL + 'Account__r']['Name'] %></a>  
           <% } %>
           </div>
          </div>
    </div>
    <div class="content">
        <div class="es-section-header">
            <span class="es-section-label">Opportunity</span>
        </div>
          <div class="form-control-group">
           <div class="form-control form-control-text">
            <% if (typeof(agreement.agreement[NAMESPACE_FULL + 'Opportunity__c']) != "undefined") { %>
                <a style="vertical-align: super;" id="agreementOpportunity" href="javascript:sforce.one.navigateToSObject('<%= agreement.agreement[NAMESPACE_FULL + 'Opportunity__c'] %>')"><%= agreement.agreement[NAMESPACE_FULL + 'Opportunity__r']['Name'] %></a>    
           <% } %>
           </div>
          </div>
    </div>
    <div class="content">
        <div class="es-section-header">
            <span class="es-section-label">Contract</span>
        </div>
          <div class="form-control-group">
           <div class="form-control form-control-text">
            <% if (typeof(agreement.agreement[NAMESPACE_FULL + 'Contract__c']) != "undefined") { %>
                <a style="vertical-align: super;" id="agreementContract" href="javascript:sforce.one.navigateToSObject('<%= agreement.agreement[NAMESPACE_FULL + 'Contract__c'] %>')"><%= agreement.agreement[NAMESPACE_FULL + 'Contract__r']['Name'] %></a>    
           <% } %>
           </div>
          </div>
    </div>
</section>

<div style="padding-left: 5px; padding-right: 2px;">
<article id="documents-view-content" class="mam bg-1 border border--3 brm">
  <ul id="documents-view-list" class="man pan list-plain">
    <li class="pam border-bottom border--8">
      <div class="mbs flag flag--rev">
        <div style="width: 20px;" class="flag--body">
          <h1 class="fl man fw-normal f5 text-color-1">Documents</h1>
        </div>
      </div>
    </li>
  </ul>
</article>
</div>

<div style="padding-left: 5px; padding-right: 2px;">
<article id="events-view-content" class="mam bg-1 border border--3 brm">
  <ul id="events-view-list" class="man pan list-plain">
    <li class="pam border-bottom border--8">
      <div class="mbs flag flag--rev">
        <div style="width: 20px;" class="flag--body">
          <h1 class="fl man fw-normal f5 text-color-1">Events</h1>
        </div>
      </div>
    </li>
  </ul>
</article>
</div>

</div>

<section class="data-capture-buttons one-buttons">
    <div id="bottom-view-action-buttons" style="display: none; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="hostedSignButtonBottom" style="display: none;" onclick="sendHostedAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Host Signing</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="sendReminderButtonBottom" onclick="sendReminder('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Remind</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="cancelAgreementButtonBottom" onclick="window.location.href = '#/agreement/cancel/<%= agreement.agreement.Id %>'" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="removeAgreementButtonBottom" onclick="window.location.href = '#/agreement/remove/<%= agreement.agreement.Id %>'" class="es-subbutton"><span class="es-subbutton-label">Delete</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="viewAgreementButtonBottom" onclick="viewAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">View</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="updateAgreementButtonBottom" onclick="updateAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Update</span></button>
        </li>
    </ul>
    </div>
    <div id="es-buttons-phone-bottom" style="display: none; padding-top: 15px;">
<div style="background-color: inherit;" class="bg-1 brm pam pos-rel tc">
  <button id="hostedSignButtonPhoneBottom" style="display: none;" onclick="sendHostedAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Host Signing</span>
  </button>
  <button id="sendReminderButtonMobileBottom" onclick="sendReminder('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Remind</span>
  </button>
  <button id="cancelAgreementButtonMobileBottom" onclick="window.location.href = '#/agreement/cancel/<%= agreement.agreement.Id %>'" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Cancel</span>
  </button>
  <button id="deleteAgreementButtonMobileBottom" onclick="window.location.href = '#/agreement/remove/<%= agreement.agreement.Id %>'" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Delete</span>
  </button>
  <button id="viewAgreementButtonMobileBottom" onclick="viewAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">View</span>
  </button>
  <button id="updateAgreementButtonMobileBottom" onclick="updateAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Update</span>
  </button>
</div>
    </div>
</section><!--.data-capture-buttons-->

</div><!--#app-content-->
</div><!--#app-wrapper-->

<div class="modal">
    <div class="background"></div>
    <div class="modal-content-wrapper">
        <div class="modal-content">
            <div class="detail-view-header">
                <div class="content">
                    <h1>Header Here</h1>
                </div><!--.content-->
            </div><!--.detail-view-header-->
            <section style="min-height:70%;">
                <div class="content">
                    <center>Content Here</center>
                </div><!-- .content -->
            </section>
            <section>
                <div class="content">
                    <div class="data-capture-buttons two-buttons">
                        <div class="content">
                            <a href="#" class="close-modal">cancel</a>
                            <a href="#" class="close-modal">submit</a>
                        </div><!-- .content -->
                    </div><!--.data-capture-buttons-->
                </div><!-- .content -->
            </section>
        </div> <!-- .modal-content -->
    </div><!-- .modal-content-wrapper -->
</div><!-- #modal.modal -->
                   
                </div>
            </div>
    </script>  
    
       <script type="text/html" id='editView'>
            <div class="app-wrapper">
                <div id="agreement-header-panel" style="display: none;" class="es-agreement-header-panel">
                    <header class="es-agreement-header">
                        <div>
                            <img style="height: 50px; border-radius: 3px; margin-top: 20px; margin-left: 2%;" src="{!$Resource.AgreementLogo}"/>
                        </div>
                        <div>
                            <div>
                                <h1>
                                    <span style="word-wrap:break-word;" id="agreement-name-header"><%= agreement.agreement.Name %></span><br/>
                                    <span id="edit-status-span"><%= agreement.agreement[NAMESPACE_FULL + 'Status__c'] %></span>
                                </h1>
                            </div>
                        </div>
                    </header>
                </div>
                <div id="agreement-header-panel-phone" style="display: none;" class="es-agreement-header-panel-phone">
                    <header class="es-agreement-header-phone">
                        <div>

                            <div>
                                <h1>
                                    <img style="height: 50px; border-radius: 3px; margin-top: -20px;" src="{!$Resource.AgreementLogo}"/>
                                    <br/>
                                    <div>
                                        <span style="word-wrap:break-word;" id="agreement-name-header"><%= agreement.agreement.Name %></span><br/>
                                        <span id="edit-status-mobile-span"><%= agreement.agreement[NAMESPACE_FULL + 'Status__c'] %></span>
                                    </div>
                                </h1>
                            </div>
                        </div>
                    </header>
                </div>

                <!-- <div class="app-content" id="hostSigningAgreement" style="display: none;">
                    <section id="closeButtonSection" class="data-capture-buttons one-buttons">
                        <div class="content">
                            <button onclick="closeSendConfirmation('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 text-color-4 f3 fw-semibold">
                                Close
                            </button>
                        </div>
                    </section>
                    <div style="width: 95%; padding-left: 7%; overflow: auto;"><iframe id="hostSigningAgreementFrame" width="90%" height="500px" scrolling="yes" /></div>
                    <section id="closeButtonSectionBottom" class="data-capture-buttons one-buttons">
                        <div class="content">
                            <button onclick="closeSendConfirmation('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 text-color-4 f3 fw-semibold">
                                Close
                            </button>
                        </div>
                    </section>
                </div>

                <div class="app-content" id="sendConfirmation" style="display: none;">
                    <section id="closeButtonSection" class="data-capture-buttons one-buttons">
                        <div class="content">
                            <button onclick="closeSendConfirmation('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 text-color-4 f3 fw-semibold">
                                Close
                            </button>
                        </div>
                    </section>
                    <div style="width: 95%; padding-left: 7%; overflow: auto;"><iframe id="sendConfirmationFrame" width="90%" height="500px" scrolling="yes" /></div>
                    <section id="closeButtonSectionBottom" class="data-capture-buttons one-buttons">
                        <div class="content">
                            <button onclick="closeSendConfirmation('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 text-color-4 f3 fw-semibold">
                                Close
                            </button>
                        </div>
                    </section>
                </div> -->

                <div class="app-content" id="progressSpinner" style="display: none; margin-right: 10%; margin-top: 25%; margin-left: 10%;" >
                    <div class="size-full bg-1 paxs border border--4 brl">
                        <div id="progressBarElement" class="size-0of10 ht-7 bg-10 brm"></div>
                    </div>
                </div>   

                <div class="app-content" id="saveProgressSpinner" style="display: none;" >
                    <div class="es-loading-section tc">
                        <img src="{!URLFOR($Resource.OneStarter,'assets/loading-gray.gif')}" alt="loading" class="sq-20 dib">
                    </div>
                </div>  

                <div class="app-content" id="saveAgreementContent">


<section class="data-capture-buttons one-buttons">
    <div id="es-buttons-top" style="display: none; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="sendAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Send</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="hostedSignButton" style="display: none;" onclick="sendHostedButtonAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Host Signing</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="saveAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Save</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="removeAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Delete</span></button>
        </li>
    </ul>
    </div>
    <div id="es-buttons-phone-top" style="display: none; padding-top: 15px;">
<div style="background-color: inherit;" class="bg-1 brm pam pos-rel tc">
  <button onclick="sendAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Send</span>
  </button>
  <button style="display: none;" id="hostedSignButtonPhone" onclick="sendHostedButtonAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Host Signing</span>
  </button>
  <button onclick="saveAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Save</span>
  </button>
  <button onclick="removeAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2">
    <span class="text-color-4 f3 fw-semibold">Delete</span>
  </button>
</div>
    </div>
</section>

<div class="app-content" style="display: none;" id="agreementErrorPanel">
<section class="bg-7 border-bottom border--3">
  <div class="flag">
    <div class="flag--image phm">
      <span class="text-error icon-utility-error"></span>
    </div>
    <div class="flag--body">
      <h1 class="mvm fw-semibold text-color-1 f4">
        Agreement Error
      </h1>
    </div>
  </div>
  <p id="agreementErrorMessage" class="mhm mtn f6 text-color-1">
  </p>
</section>
</div>

<!-- TEST AREA -->

<!-- END OF TEST -->



<div>
    <!-- <div style="padding-left: 20px;">
        <label class="es-input-label">
            <span>Recipients</span>
        </label>
    </div> -->

<div style="padding-left: 5px; padding-right: 2px;">
<article id="recipients-edit-content" class="mam bg-1 border border--3 brm">
  <!-- <header style="position: relative; background-color: white;" class="clear pam border-bottom border--8">
    <h1 style="padding-right: 90%; margin-left: 10px;" class="fl man fw-normal f5 text-color-1">Recipients</h1>
    <a href="javascript:addRecipient('<%= agreement.agreement.Id %>');" title="Add Recipient" style="padding-top: 4px;" class="fr">
      <span class="fl f5">Add Recipient</span>
      <span class="lh-16 fl mls f6 text-color-2 icon-utility-right"></span>
    </a>
  </header> -->
  <ul id="recipients-edit-list" class="man pan list-plain">
    <li class="pam border-bottom border--8">
      <div class="mbs flag flag--rev">
        <div style="width: 20px;" class="flag--body">
          <h1 class="fl man fw-normal f5 text-color-1">Recipients</h1>
        </div>
        <div class="flag--image prm">
            <a href="javascript:addRecipient('<%= agreement.agreement.Id %>');" title="Add Recipient" style="padding-top: 4px;" class="fr">
                <span class="fl f5">Add Recipient</span>
                <span class="lh-16 fl mls f6 text-color-2 icon-utility-right"></span>
            </a>
        </div>
      </div>
    </li>
  </ul>
</article>
</div>
</div>

    <section style="border-bottom-width: 0px;" class="border-bottom">  
        <div class="content">
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>Agreement Name</span>
                    <div class="es-input-value">
                        <input id="agreementNameValue" type="text" name="default" value="<%= agreement.agreement.Name %>" placeholder="Agreement Name" class="mbm size-full phm pvm input input--default input--ph-1 input--focus-1"/>
                    </div>
                </label>
            </div>
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>Message</span>
                    <div class="es-input-value">
                        <textarea id="agreementMessageValue" name="default" placeholder="" class="size-full phm pvm textarea textarea--default textarea--ph-1 textarea--focus-1"><%= agreement.agreement[NAMESPACE_FULL + 'Message__c'] %></textarea>  
                    </div>
                </label>
            </div>
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>Email Copies To</span>
                    <div class="es-input-value">
                        <input id="agreementCcValue" type="text" name="default" value="<%= agreement.agreement[NAMESPACE_FULL + 'Cc__c'] %>" placeholder="" class="mbm size-full phm pvm input input--default input--ph-1 input--focus-1"/>
                    </div>
                </label>
            </div>
        </div>
    </section>
    <section style="border-bottom-width: 0px;" class="border-bottom">

         <div class="content">
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>Language</span>
                </label>
                <div style="margin-top: 10px;" class="mbm pos-rel">
                    <span class="label--icon-r icon-utility-down size-full"></span>
                    <select id="languageSelect" size="1" style="-webkit-appearance: none; height: 100%;" class="size-full plm prx pvm bg-secondary-btn input">
                    </select>
                </div>
            </div>
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>Remind Recipient</span>
                </label>
                <div style="margin-top: 10px;" class="mbm pos-rel">
                    <span class="label--icon-r icon-utility-down size-full"></span>
                    <select id="remindersSelect" size="1" style="-webkit-appearance: none; height: 100%;" class="size-full plm prx pvm bg-secondary-btn input">
                    </select>
                </div>
            </div>
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>Sender Signature</span>
                </label>
                <div style="margin-top: 10px;" class="mbm pos-rel">
                    <span class="label--icon-r icon-utility-down size-full"></span>
                    <select id="senderSignatureSelect" size="1" style="-webkit-appearance: none; height: 100%;" class="size-full plm prx pvm bg-secondary-btn input">
                    </select>
                </div>
            </div>
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>Expiration Date</span>
                </label>
                <div style="margin-bottom: -20px; margin-top: 10px;" class="form-control form-control-number">
                    <input class="es-section-label" style="vertical-align: top;" type="date" name="date" id="agreementExpirationInput"/>
                </div>
            </div>
         </div>

<div class="content">
    <label style="padding-left: 0px; padding-bottom: 10px;" class="label inputLabel uiLabel-left uiLabel">
        <span>Account Name</span>
    </label>
    <div class="mbm pos-rel">
        <label id="agreement-account-label" class="size-full pos-abs label--lookup">
            <span class="dn">Select Account</span>
        </label>
        <input id="agreement-account-input" type="text" name="default" placeholder="Select Account" class="size-full plm prx pvm input input--default input--ph-1 input--focus-1"/>
    </div>
</div>

<div class="content">
    <label style="padding-left: 0px; padding-bottom: 10px;" class="label inputLabel uiLabel-left uiLabel">
        <span>Opportunity Name</span>
    </label>
    <div class="mbm pos-rel">
        <label id="agreement-opp-label" class="size-full pos-abs label--lookup" onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>/opps';">
            <span class="dn">Select Opportunity</span>
        </label>
        <input id="agreement-opp-input" onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>/opps';" type="text" name="default" placeholder="Select Opportunity" class="size-full plm prx pvm input input--default input--ph-1 input--focus-1"/>
    </div>
</div>

<div class="content">
    <label style="padding-left: 0px; padding-bottom: 10px;" class="label inputLabel uiLabel-left uiLabel">
        <span>Contract Number</span>
    </label>
    <div class="mbm pos-rel">
        <label id="agreement-contract-label" class="size-full pos-abs label--lookup" onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>/contracts';">
            <span class="dn">Select Contract</span>
        </label>
        <input id="agreement-contract-input" onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>/contracts';" type="text" name="default" placeholder="Select Contract" class="size-full plm prx pvm input input--default input--ph-1 input--focus-1"/>
    </div>
</div>
         
         </section>

<!-- <ul class="list-view right-one-icons large-padding">
            <li>
                <a href="javascript:navToRecipientsEdit('<%= agreement.agreement.Id %>');" class="content">
        <div class="es-section-header">
            <span class="es-section-label">Recipients</span>
        </div>
                    <div> -->
                        <!-- <img height="35px" style="background-color: #4EB1CB; border-radius: 5px;" src="{!URLFOR($Resource.s1custom,'s1custom/custom15_60.png')}"/> -->
                        <!-- <span class="es-section-label" id="recipientsSummaryLabel" />
                    </div>
                    <div class="list-view-icons">
                        <span class="icon-right-arrow">&nbsp;</span>
                    </div>
                </a>
            </li>
        </ul> -->

<!-- <ul class="list-view right-one-icons large-padding">
            <li>
                <a href="javascript:navToDocumentsEdit('<%= agreement.agreement.Id %>');" class="content">
        <div class="es-section-header">
            <span class="es-section-label">Documents</span>
        </div>
                    <div> -->
                        <!-- <img height="35px" style="border-radius: 5px;" src="{!URLFOR($Resource.s1doctype,'s1doctypes/gdoc_60.png')}"/> -->
                        <!-- <span class="es-section-label" id="documentsSummaryLabel" />
                    </div>
                    <div class="list-view-icons">
                        <span class="icon-right-arrow">&nbsp;</span>
                    </div>
                </a>
            </li>
        </ul> -->

<!-- <div class="popup">
    <div class="overlay"></div>
    <div class="popupContent">
        popup content here
    </div>
</div> -->

            <div id="overlay" class="overlay">

            <% if ( isMobilePhone ) { %>
                <div id="document-add-actions-dialog" class="buttons-overlay" style="padding-left: 0%; padding-top: 40%;">   
           <% } %>
            <% if ( !isMobilePhone ) { %>
                <div id="document-add-actions-dialog" class="buttons-overlay">   
           <% } %>
<a href="javascript:hideAddDocumentActionsDialog();" name="close" title="close" class="db tr size-full pbm">
  <span class="db icon-utility-close f2 wht"></span>
</a>
<div class="bg-1 brm pam pos-rel tc">
  <button id="library-document-add-button" autofocus="autofocus" onclick="addTemplateDocument('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Add EchoSign Library Document</span>
  </button>
  <button onclick="addContentDocument('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Add Salesforce CRM Content or Files</span>
  </button>
  <button onclick="addLibraryDocument('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2">
    <span class="text-color-4 f3 fw-semibold">Add Salesforce Document</span>
  </button>
</div>
</div>
            </div>

<div style="padding-left: 5px; padding-right: 2px;">
<article id="documents-edit-content" class="mam bg-1 border border--3 brm">
  <ul id="documents-edit-list" class="man pan list-plain">
    <li class="pam border-bottom border--8">
      <div class="mbs flag flag--rev">
        <div style="width: 20px;" class="flag--body">
          <h1 class="fl man fw-normal f5 text-color-1">Documents</h1>
        </div>
        <div class="flag--image prm">
            <a href="javascript:showAddDocumentActionsDialog();" title="Add Document" style="padding-top: 4px;" class="fr">
                <span class="fl f5">Add Document</span>
                <span class="lh-16 fl mls f6 text-color-2 icon-utility-right"></span>
            </a>
        </div>
      </div>
    </li>
  </ul>
</article>
</div>
</div>

<section class="data-capture-buttons one-buttons">
    <div id="es-buttons-bottom" style="display: none; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="sendAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Send</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="hostedSignButtonBottom" style="display: none;" onclick="sendHostedButtonAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Host Signing</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="saveAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Save</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="removeAgreement('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Delete</span></button>
        </li>
        <!-- <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button class="es-subbutton"><span class="es-subbutton-label"></span></button>
        </li> -->
    </ul>
    </div>
    <div id="es-buttons-phone-bottom" style="display: none; padding-top: 15px;">
<div style="background-color: inherit;" class="bg-1 brm pam pos-rel tc">
  <button onclick="sendAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Send</span>
  </button>
  <button id="hostedSignButtonPhoneBottom" style="display: none;" onclick="sendHostedButtonAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Host Signing</span>
  </button>
  <button onclick="saveAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm">
    <span class="text-color-4 f3 fw-semibold">Save</span>
  </button>
  <button onclick="removeAgreement('<%= agreement.agreement.Id %>');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2">
    <span class="text-color-4 f3 fw-semibold">Delete</span>
  </button>
</div>
    </div>
</section>

</div><!--#app-content-->
</div><!--#app-wrapper-->
            

<div class="modal">
    <div class="background"></div>
    <div class="modal-content-wrapper">
        <div class="modal-content">
            <div class="detail-view-header">
                <div class="content">
                    <h1>Header Here</h1>
                </div><!--.content-->
            </div><!--.detail-view-header-->
            <section style="min-height:70%;">
                <div class="content">
                    <center>Content Here</center>
                </div><!-- .content -->
            </section>
            <section>
                <div class="content">
                    <div class="data-capture-buttons two-buttons">
                        <div class="content">
                            <a href="#" class="close-modal">cancel</a>
                            <a href="#" class="close-modal">submit</a>
                        </div><!-- .content -->
                    </div><!--.data-capture-buttons-->
                </div><!-- .content -->
            </section>
        </div> <!-- .modal-content -->
    </div><!-- .modal-content-wrapper -->
</div><!-- #modal.modal -->
                   
                </div>
            </div>

    </script>
  
  
         <script type="text/html" id='editRecipientsView'>
            <div class="app-wrapper">
                <div class="es-agreement-header-panel">
                <header class="es-agreement-header">
                        <!-- <div class="main-menu-button main-menu-button-left"><a class="left-arrow" href="#/agreement/edit/<%= agreement.agreement.Id %>/recipients">&nbsp;</a></div> -->
                    <h1>Recipient</h1>
                </header>
                </div>

                <div class="app-content" id="editRecipientsContent">
                    <section style="border-bottom-width: 0px;" class="border-bottom">

         <div class="content">
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>Role</span>
                </label>
                <!-- <div style="margin-bottom: -40px;">
                    <img height="35px" style="background-color: #4EB1CB; border-radius: 5px;" src="{!URLFOR($Resource.s1custom,'s1custom/custom45_60.png')}"/>
                </div> -->
                <div style="margin-top: 10px;" class="mbm pos-rel">
                    <span class="label--icon-r icon-utility-down size-full"></span>
                    <select id="recipientRoleSelect" size="1" style="-webkit-appearance: none; height: 100%;" class="size-full plm prx pvm bg-secondary-btn input input--picklist">
                    </select>
                </div>
            </div>
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>Type</span>
                </label>
                <!-- <div style="margin-bottom: -40px;">
                    <img height="35px" style="background-color: #4EB1CB; border-radius: 5px;" src="{!URLFOR($Resource.s1custom,'s1custom/custom84_60.png')}"/>
                </div> -->
                <div style="margin-top: 10px;" class="mbm pos-rel">
                    <span class="label--icon-r icon-utility-down size-full"></span>
                    <select id="recipientTypeSelect" size="1" style="-webkit-appearance: none; height: 100%;" class="size-full plm prx pvm bg-secondary-btn input input--picklist">
                    </select>
                </div>
            </div>
<div id="recipient-contact-section" style="display: none;">
    <label style="padding-left: 0px; padding-bottom: 10px;" class="label inputLabel uiLabel-left uiLabel">
        <span>Contact Name</span>
    </label>
    <div id="recipient-contact-input-panel" class="mbm pos-rel"> 
        <img style="background-color: #2A94D6; height: 36px; border-radius: 5px; position: absolute; margin-left: -5px;" height="45px" src="{!URLFOR($Resource.s1standard,'s1standard/contact_60.png')}"/>
        <label id="recipient-contact-label" style="margin-left: 35px;" class="size-full pos-abs label--lookup">
            <span class="dn">Select Contact</span>
        </label>
        <input id="recipient-contact-input" style="margin-left: 40px;" type="text" name="default" placeholder="Select Contact" class="size-full plm prx pvm input input--default input--ph-1 input--focus-1"/>
    </div>
</div>
<div id="recipient-lead-section" style="display: none;">
    <label style="padding-left: 0px; padding-bottom: 10px;" class="label inputLabel uiLabel-left uiLabel">
        <span>Lead Name</span>
    </label>
    <div id="recipient-lead-input-panel" class="mbm pos-rel"> 
        <img style="background-color: #F3AE4E; height: 36px; border-radius: 5px; position: absolute; margin-left: -5px;" height="45px" src="{!URLFOR($Resource.s1standard,'s1standard/lead_60.png')}"/>
        <label id="recipient-lead-label" style="margin-left: 35px;" class="size-full pos-abs label--lookup">
            <span class="dn">Select Lead</span>
        </label>
        <input id="recipient-lead-input" style="margin-left: 40px;" type="text" name="default" placeholder="Select Lead" class="size-full plm prx pvm input input--default input--ph-1 input--focus-1"/>
    </div>
</div>
<div id="recipient-user-section" style="display: none;">
    <label style="padding-left: 0px; padding-bottom: 10px;" class="label inputLabel uiLabel-left uiLabel">
        <span>User Name</span>
    </label>
    <div id="recipient-user-input-panel" class="mbm pos-rel"> 
        <img style="background-color: #4EB1CB; height: 36px; border-radius: 5px; position: absolute; margin-left: -5px;" height="45px" src="{!URLFOR($Resource.s1standard,'s1standard/people_60.png')}"/>
        <label id="recipient-user-label" style="margin-left: 35px;" class="size-full pos-abs label--lookup">
            <span class="dn">Select User</span>
        </label>
        <input id="recipient-user-input" style="margin-left: 40px;" type="text" name="default" placeholder="Select User" class="size-full plm prx pvm input input--default input--ph-1 input--focus-1"/>
    </div>
</div>
        <div id="recipient-email-section" style="display: none; padding-bottom: 160px;">
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>Email</span>
                    <div class="es-input-value">
                        <input id="recipientEmailValue" type="email" name="default" value="<%= recipient[NAMESPACE_FULL + 'Email_Address__c'] %>" placeholder="Enter email address" class="mbm size-full phm pvm input input--default input--ph-1 input--focus-1"/>
                    </div>
                </label>
            </div>
        </div>
        <div id="recipient-email-display-section" style="display: none;">
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>Email</span>
                    <div class="es-input-value">
                        <input id="recipient-email-label" type="text" name="default" value="" placeholder="" class="mbm size-full phm pvm input input--default input--ph-1 input--focus-1"/>
                    </div>
                </label>
            </div>
        </div>
         </div>








    </section>

<section class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="saveRecipientEdit('<%= agreement.agreement.Id %>', '<%= recipientIndex %>');" class="es-subbutton"><span class="es-subbutton-label">Save</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button id="recipient-edit-delete-button" onclick="deleteRecipient('<%= agreement.agreement.Id %>', '<%= recipientIndex %>');" style="display: none;" class="es-subbutton"><span class="es-subbutton-label">Delete</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>';" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
        </li>
    </ul>
    </div>
</section><!--.data-capture-buttons-->

                </div><!--#app-content-->
            </div><!--#app-wrapper-->  
  </script> 
        
  
         <script type="text/html" id='editDocumentsView'>
            <div class="app-wrapper">
                <div class="es-agreement-header-panel">
                <header class="es-agreement-header">
                        <!-- <div class="main-menu-button main-menu-button-left"><a class="left-arrow" href="javascript:saveDocumentEdit('<%= agreement.agreement.Id %>', '<%= documentIndex %>');">&nbsp;</a></div> -->
                    <h1>Document</h1>
                </header>
                </div>

                <div class="app-content" id="editDocumentsContent">
                    <section style="border-bottom-width: 0px;" class="border-bottom">

    <div class="content">
        <div class="es-section-header">
            <span class="es-section-header">Title</span>
        </div>
        <p>
            <span class="es-section-header"><%= document.name %></span>
        </p>
    </div>

    </section>
<section class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="deleteDocument('<%= agreement.agreement.Id %>', '<%= documentIndex %>');" class="es-subbutton"><span class="es-subbutton-label">Delete</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>';" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
        </li>
    </ul>
    </div>
</section><!--.data-capture-buttons-->
                </div><!--#app-content-->
            </div><!--#app-wrapper-->  
  </script>  

         <script type="text/html" id='documentsTemplatesView'>
            <div class="app-wrapper">
                <div class="es-agreement-header-panel">
                <header class="es-agreement-header">
                        <!-- <div class="main-menu-button main-menu-button-left"><a class="left-arrow" href="#/agreement/edit/<%= agreement.agreement.Id %>/documents">&nbsp;</a></div> -->
                    <h1>EchoSign Library Documents</h1>
                </header>
                </div>

                <div class="app-content" id="documentsTemplatesContent">

<section class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>';" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
        </li>
    </ul>
    </div>
</section>

<ul class="list-view right-one-icons large-padding">

                <% for(var i = 0; i < templateDocuments.length; i++){ %>
    <li>
        <a href="javascript:storeTemplateDocument('<%= agreement.agreement.Id %>', '<%= i %>');" class="content">
            <div class="detail-view-table">
                    <div class="detail-view-table-row last-child">
                        <div class="detail-view-table-left-column">
                            <% if ( templateDocuments[i].isDocument ) { %>
                                <img src="{!$Resource.LibraryDocumentTemplate}" style="height: 18px;"/>
                            <% } %>
                            <% if ( !templateDocuments[i].isDocument && templateDocuments[i].isFormFieldLayer ) { %>
                                <img src="{!$Resource.LibraryFieldsTemplate}"/>
                            <% } %>
                        </div>
                        <div class="detail-view-table-right-column" style="padding-top: 8px;">
                                <%= templateDocuments[i].name %>
                        </div>
                    </div>
            </div>
            <div class="list-view-icons">
                <span class="icon-right-arrow">&nbsp;</span>
            </div>
        </a>
    </li>
                <% } %>
</ul>


<!-- <section class="data-capture-buttons one-buttons">
    <div class="content">
        <a href="javascript:storeTemplateDocument('<%= agreement.agreement.Id %>');">Add</a>
    </div>
</section> --> <!--.data-capture-buttons-->

<section class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>';" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
        </li>
    </ul>
    </div>
</section>

                </div><!--#app-content-->
            </div><!--#app-wrapper-->  
  </script>
  
  
         <script type="text/html" id='documentsLibrariesView'>
            <div class="app-wrapper">
                <div class="es-agreement-header-panel">
                <header class="es-agreement-header">
                        <!-- <div class="main-menu-button main-menu-button-left"><a class="left-arrow" href="#/agreement/edit/<%= agreement.agreement.Id %>/documents">&nbsp;</a></div> -->
                    <h1>Salesforce Documents</h1>
                </header>
                </div>

                <div class="app-content" id="documentsLibrariesContent">

<section class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>';" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
        </li>
    </ul>
    </div>
</section>

<section style="border-bottom-width: 0px;" class="border-bottom">
         <div class="content">
            <div class="es-section-header">
                <span class="es-section-header">Folder</span>
            </div>
          <div class="form-control-group">
           <div class="form-control form-control-select">
            <select class="es-section-header" id="documentLibraryFolderSelect">
            </select>
           </div>
          </div>
         </div>
</section>

<ul class="list-view right-one-icons large-padding">

                <% for(var i = 0; i < folderLibraryDocuments.length; i++){ %>
    <li>
        <a href="javascript:storeLibraryDocument('<%= agreement.agreement.Id %>', '<%= folderLibraryDocuments[i]['Id'] %>');" class="content">
            <div class="detail-view-table">
                    <div class="detail-view-table-row last-child">
                        <div class="detail-view-table-left-column">
                            <% if ( folderLibraryDocuments[i]['Type'] == 'pdf' ) { %>
                                <img width="30px" height="35px" src="{!URLFOR($Resource.s1doctype,'s1doctypes/pdf_60.png')}" onclick="window.open('/servlet/servlet.FileDownload?file=<%= folderLibraryDocuments[i]['Id'] %>','viewlibrary'); return false;"/>
                            <% } %>
                            <% if ( folderLibraryDocuments[i]['Type'] == 'doc' || folderLibraryDocuments[i]['Type'] == 'docx' ) { %>
                                <img width="30px" height="35px" src="{!URLFOR($Resource.s1doctype,'s1doctypes/word_60.png')}" onclick="window.open('/servlet/servlet.FileDownload?file=<%= folderLibraryDocuments[i]['Id'] %>','viewlibrary'); return false;"/>
                            <% } %>
                            <% if ( folderLibraryDocuments[i]['Type'] == 'ppt' || folderLibraryDocuments[i]['Type'] == 'pptx' ) { %>
                                <img width="30px" height="35px" src="{!URLFOR($Resource.s1doctype,'s1doctypes/ppt_60.png')}" onclick="window.open('/servlet/servlet.FileDownload?file=<%= folderLibraryDocuments[i]['Id'] %>','viewlibrary'); return false;"/>
                            <% } %>
                            <% if ( folderLibraryDocuments[i]['Type'] == 'xls' || folderLibraryDocuments[i]['Type'] == 'xlsx' ) { %>
                                <img width="30px" height="35px" src="{!URLFOR($Resource.s1doctype,'s1doctypes/excel_60.png')}" onclick="window.open('/servlet/servlet.FileDownload?file=<%= folderLibraryDocuments[i]['Id'] %>','viewlibrary'); return false;"/>
                            <% } %>
                            <% if ( folderLibraryDocuments[i]['Type'] == 'jpeg' || folderLibraryDocuments[i]['Type'] == 'jpg' || folderLibraryDocuments[i]['Type'] == 'png' || folderLibraryDocuments[i]['Type'] == 'gif' ) { %>
                                <img width="30px" height="35px" src="{!URLFOR($Resource.s1doctype,'s1doctypes/image_60.png')}" onclick="window.open('/servlet/servlet.FileDownload?file=<%= folderLibraryDocuments[i]['Id'] %>','viewlibrary'); return false;"/>
                            <% } %>
                        </div>
                        <div style="padding-top: 15px;" class="detail-view-table-right-column">
                                <!-- <div>
                                    <img src="{!$Resource.ActionAttachmentView}" onclick="window.open('/servlet/servlet.FileDownload?file=<%= folderLibraryDocuments[i]['Id'] %>','viewlibrary'); return false;"/>
                                </div>
                                <div>
                                    <span class="es-section-header"><%= folderLibraryDocuments[i]['Name'] %></span>
                                </div> -->

                                <span><%= folderLibraryDocuments[i]['Name'] %></span>
                        </div>
                    </div>
            </div>
            <div class="list-view-icons">
                <span class="icon-right-arrow">&nbsp;</span>
            </div>
        </a>
    </li>
                <% } %>
</ul>

<section class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>';" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
        </li>
    </ul>
    </div>
</section>

                </div><!--#app-content-->
            </div><!--#app-wrapper-->  
  </script>


  
         <script type="text/html" id='documentsContentsView'>
            <div class="app-wrapper">
                <div class="es-agreement-header-panel">
                <header class="es-agreement-header">
                        <!-- <div class="main-menu-button main-menu-button-left"><a class="left-arrow" href="#/agreement/edit/<%= agreement.agreement.Id %>/documents">&nbsp;</a></div> -->
                    <h1>Salesforce Content</h1>
                </header>
                </div>

                <div class="app-content" id="documentsContentsContent">

<section class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>';" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
        </li>
    </ul>
    </div>
</section>

<section style="border-bottom-width: 0px;" class="border-bottom">
         <div class="content">
            <div class="es-section-header">
                <span class="es-section-header">Library</span>
            </div>
          <div class="form-control-group">
           <div class="form-control form-control-select">
            <select class="es-section-header" id="documentContentLibrarySelect">
            </select>
           </div>
          </div>
         </div>
</section>

<ul class="list-view right-one-icons large-padding">

                <% for(var i = 0; i < libraryContentDocuments.length; i++){ %>
    <li>
        <a href="javascript:storeContentDocument('<%= agreement.agreement.Id %>', '<%= libraryContentDocuments[i]['Id'] %>');" class="content">
            <div class="detail-view-table">
                    <div class="detail-view-table-row last-child">
                        <div class="detail-view-table-left-column">
                            <% if ( libraryContentDocuments[i]['FileType'] == 'PDF' ) { %>
                                <img style="margin-top: -10%;" width="30px" height="35px" src="{!URLFOR($Resource.s1doctype,'s1doctypes/pdf_60.png')}"/>
                            <% } %>
                            <% if ( libraryContentDocuments[i]['FileType'] == 'WORD' || libraryContentDocuments[i]['FileType'] == 'WORD_X' ) { %>
                                <img style="margin-top: -10%;" width="30px" height="35px" src="{!URLFOR($Resource.s1doctype,'s1doctypes/word_60.png')}"/>
                            <% } %>
                            <% if ( libraryContentDocuments[i]['FileType'] == 'POWER_POINT' || libraryContentDocuments[i]['FileType'] == 'POWER_POINT_X' ) { %>
                                <img style="margin-top: -10%;" width="30px" height="35px" src="{!URLFOR($Resource.s1doctype,'s1doctypes/ppt_60.png')}"/>
                            <% } %>
                            <% if ( libraryContentDocuments[i]['FileType'] == 'EXCEL' || libraryContentDocuments[i]['FileType'] == 'EXCEL_X' ) { %>
                                <img style="margin-top: -10%;" width="30px" height="35px" src="{!URLFOR($Resource.s1doctype,'s1doctypes/excel_60.png')}"/>
                            <% } %>
                            <% if ( libraryContentDocuments[i]['FileType'] == 'JPEG' || libraryContentDocuments[i]['FileType'] == 'JPG' || libraryContentDocuments[i]['FileType'] == 'PNG' || libraryContentDocuments[i]['FileType'] == 'GIF' ) { %>
                                <img style="margin-top: -10%;" width="30px" height="35px" src="{!URLFOR($Resource.s1doctype,'s1doctypes/image_60.png')}"/>
                            <% } %>
                        </div>
                        <div class="detail-view-table-right-column" style="padding-top: 10px;">
                            <span class="es-section-header"><%= libraryContentDocuments[i]['Title'] %></span>
                        </div>
                    </div>
            </div>
            <div class="list-view-icons">
                <span class="icon-right-arrow">&nbsp;</span>
            </div>
        </a>
    </li>
                <% } %>
</ul>

<section class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>';" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
        </li>
    </ul>
    </div>
</section>

                </div><!--#app-content-->
            </div><!--#app-wrapper-->  
  </script>   
  
  <!-- <script type="text/html" id='removeView'>
            <div class="app-wrapper">
 
                <header class="es-agreement-header">
                    <div class="main-menu-button main-menu-button-left"><a class="left-arrow" href="#/agreement/<%= agreement.agreement.Id %>">&nbsp;</a></div>
                    <h1>{! JSENCODE($Label.Delete_Agreement_Prompt) } <%= agreement.agreement.Name %>?</h1>
                </header>

                <div class="app-content" id="progressSpinner" style="display: none;" >
                    <img src="{!$Resource.LoadingSpinner}" style="width: 40px; height: 40px; margin-top: 20%; margin-left: 50%;" />  
                </div>

                <div class="app-content" id='removeContent'>
<section class="border-bottom">
         <div class="content">
          <h3>{!$Label.Reason_Prompt}</h3>
          <div class="form-control-group">
            <div class="form-control form-control-text">
                <input id="removeAgreementReason" type="text" name="text" />
           </div>
          </div>
         </div>
</section>

<section class="data-capture-buttons one-buttons">
    <div class="content">
        <a href="javascript:confirmAgreementRemove('<%= agreement.agreement.Id %>');">Confirm</a>
    </div>
</section>

                </div>
            </div> 
  </script> -->   
  
  <script type="text/html" id='cancelView'>
            <div class="app-wrapper">
                <div class="es-agreement-header-panel">
                <header class="es-agreement-header">
                    <!-- <div class="main-menu-button main-menu-button-left"><a class="left-arrow" href="#/agreement/<%= agreement.agreement.Id %>">&nbsp;</a></div> -->
                    <h1>{! JSENCODE($Label.Cancel_Agreement_Prompt) } <%= agreement.agreement.Name %>?</h1>
                </header>
                </div>

                <div class="app-content" id="cancelProgressSpinner" style="display: none;" >
                    <div class="es-loading-section tc">
                        <img src="{!URLFOR($Resource.OneStarter,'assets/loading-gray.gif')}" alt="loading" class="sq-20 dib">
                    </div> 
                </div>

                <div class="app-content" id='cancelContent'>
<section style="border-bottom-width: 0px;" class="border-bottom">
         <div class="content">
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>{!$Label.Reason_Cancel_Prompt}</span>
                    <div class="es-input-value">
                        <textarea id="cancelAgreementReason" name="default" placeholder="" class="size-full phm pvm textarea textarea--default textarea--ph-1 textarea--focus-1"></textarea>
                    </div>
                </label>
            </div>
          </div>
         </div>
</section>

<section id='cancelContentButtons' class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="confirmAgreementCancel('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Confirm</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="window.location.href = '#/agreement/<%= agreement.agreement.Id %>';" class="es-subbutton"><span class="es-subbutton-label">Back</span></button>
        </li>
    </ul>
    </div>
</section><!--.data-capture-buttons-->

                </div><!--#app-content-->
            </div><!--#app-wrapper-->  
  </script>      
  
  <script type="text/html" id='removeView'>
            <div class="app-wrapper">
                <div class="es-agreement-header-panel">
                <header class="es-agreement-header">
                    <!-- <div class="main-menu-button main-menu-button-left"><a class="left-arrow" href="#/agreement/<%= agreement.agreement.Id %>">&nbsp;</a></div> -->
                    <h1>{! JSENCODE($Label.Delete_Agreement_Prompt) } <%= agreement.agreement.Name %>?</h1>
                </header>
                </div>

                <div class="app-content" id="removeProgressSpinner" style="display: none;" >
                    <div class="es-loading-section tc">
                        <img src="{!URLFOR($Resource.OneStarter,'assets/loading-gray.gif')}" alt="loading" class="sq-20 dib">
                    </div> 
                </div>

                <div class="app-content" id='removeContent'>
<section style="border-bottom-width: 0px;" class="border-bottom">
         <div class="content">
            <div class="form-control-group">
                <label class="es-input-label">
                    <span>{!$Label.Reason_Delete_Prompt}</span>
                    <div class="es-input-value">
                        <textarea id="removeAgreementReason" name="default" placeholder="" class="size-full phm pvm textarea textarea--default textarea--ph-1 textarea--focus-1"></textarea>
                    </div>
                </label>
            </div>
         </div>
</section>

<section class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="confirmAgreementRemove('<%= agreement.agreement.Id %>');" class="es-subbutton"><span class="es-subbutton-label">Confirm</span></button>
        </li>
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
            <button onclick="window.location.href = '#/agreement/<%= agreement.agreement.Id %>';" class="es-subbutton"><span class="es-subbutton-label">Back</span></button>
        </li>
    </ul>
    </div>
</section><!--.data-capture-buttons-->

                </div><!--#app-content-->
            </div><!--#app-wrapper-->  
  </script>    
  
  <script type="text/html" id='objectsSearchView'>
            <div class="app-wrapper">
                <div class="es-agreement-header-panel">
                <header class="es-agreement-header">
                    <!-- <% if ( objectName == 'Account' || objectName == 'Opportunity' || objectName == 'Contract' ) { %>
                        <div class="main-menu-button main-menu-button-left"><a class="left-arrow" href="#/agreement/edit/<%= agreement.agreement.Id %>">&nbsp;</a></div>
                    <% } %>
                    <% if ( objectName == 'Contact' || objectName == 'Lead' || objectName == 'User' ) { %>
                        <div class="main-menu-button main-menu-button-left"><a class="left-arrow" href="#/agreement/edit/<%= agreement.agreement.Id %>/recipients/edit/<%= recipientIndex %>">&nbsp;</a></div>
                    <% } %> -->
                    <h1><%= objectName %> ID</h1>
                </header>
                </div>


<div id="objects-search-content" class="app-content">
 
    <div class="content">

                <div style="padding-top: 15px; margin-top: 7px; margin-left: 7px; margin-right: 7px; padding-bottom: 10px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(207, 212, 217);" class="searchBox">
                    <div class="searchBoxInner">
  <label style="position: relative; padding-bottom: 2px;" class="size-full icon-utility-search pos-abs label--lookup" onclick="if( '<%= objectName %>' == 'Account' ) { searchAccounts('<%= agreement.agreement.Id %>'); } else if( '<%= objectName %>' == 'Opportunity' ) { searchOpps('<%= agreement.agreement.Id %>'); } else if( '<%= objectName %>' == 'Contract' ) { searchContracts('<%= agreement.agreement.Id %>'); } else if( '<%= objectName %>' == 'Contact' ) { searchContacts('<%= agreement.agreement.Id %>', '<%= recipientIndex %>'); } else if( '<%= objectName %>' == 'Lead' ) { searchLeads('<%= agreement.agreement.Id %>', '<%= recipientIndex %>'); } else if( '<%= objectName %>' == 'User' ) { searchUsers('<%= agreement.agreement.Id %>', '<%= recipientIndex %>'); }">
    <span class="dn">Search <%= objectName %></span>
  </label>
                        <input id="objects-search-input" style="border-radius: 5px;" class="text uiInput uiInputText" placeholder="Search <%= objectName %>" type="text">
                        <a class="searchOrClear">
                            <div data-key="search" class="oneIcon">
                            </div>
                        </a>
                    </div>
                </div>

    </div>

<ul id="objects-search-list" class="list-view right-one-icons">
    <li>
        <% if ( objectName == 'Account' ) { %>
            <img height="45px" src="{!URLFOR($Resource.s1standard,'s1standard/account_60.png')}"/>
        <% } %>
        <% if ( objectName == 'Opportunity' ) { %>
            <img height="45px" src="{!URLFOR($Resource.s1standard,'s1standard/opportunity_60.png')}"/>
        <% } %>
        <% if ( objectName == 'Contract' ) { %>
            <img height="45px" src="{!URLFOR($Resource.s1standard,'s1standard/contract_60.png')}"/>
        <% } %>
        <% if ( objectName == 'Contact' ) { %>
            <img style="background-color: #2A94D6; height: 36px; border-radius: 5px; margin-right: 10px;" src="{!URLFOR($Resource.s1standard,'s1standard/contact_60.png')}"/>
        <% } %>
        <% if ( objectName == 'Lead' ) { %>
            <img style="background-color: #F3AE4E; height: 36px; border-radius: 5px; margin-right: 10px;" height="45px" src="{!URLFOR($Resource.s1standard,'s1standard/lead_60.png')}"/>
        <% } %>
        <% if ( objectName == 'User' ) { %>
            <img style="background-color: #4EB1CB; height: 36px; border-radius: 5px; margin-right: 10px;" height="45px" src="{!URLFOR($Resource.s1standard,'s1standard/people_60.png')}"/>
        <% } %>
        <span style="font-weight: bold; font-size: larger; color: rgb(0, 0, 0); vertical-align: top; margin-top: 15px; position: absolute;"><%= objectName %></span>        
    </li>
</ul>

<section class="data-capture-buttons one-buttons">
    <div style="display: block; padding-top: 15px;">
    <ul style="display: block; text-align: center; list-style-type: disc;">
        <li style="display: inline; padding-right: 18px; list-style-type: none;">
                    <% if ( objectName == 'Account' || objectName == 'Opportunity' || objectName == 'Contract' ) { %>
                        <button onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>';" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
                    <% } %>
                    <% if ( objectName == 'Contact' || objectName == 'Lead' || objectName == 'User' ) { %>
                        <button onclick="window.location.href = '#/agreement/edit/<%= agreement.agreement.Id %>/recipients/edit/<%= recipientIndex %>';" class="es-subbutton"><span class="es-subbutton-label">Cancel</span></button>
                    <% } %>
        </li>
    </ul>
    </div>
</section>


</div><!--#app-content-->

            </div><!--#app-wrapper-->  


  </script>
  
    
       <script type="text/javascript">
            var namespace = '{!namespace}';
            var NAMESPACE_FULL = namespace + '__';
            var agreementRecords = new Array();         
            var languages = new Array();
            var defaultLanguage;
            var reminders = new Array();
            var defaultReminder;
            var signatureOrders = new Array();
            var defaultSignatureOrder;
            var recipientRoles = new Array();
            var defaultRecipientRole;
            var recipientTypes = new Array();
            var defaultRecipientType;
            
            var recipients = new Array();
            
            var accounts = new Array();
            var opps = new Array();
            var contracts = new Array();
            var contacts = new Array();
            var leads = new Array();
            var users = new Array();
            
            var allAgreements = new Array();
            
            var templateDocuments = new Array();
            var libraryDocuments = new Array();
            var contentDocuments = new Array();
            var contentLibraries = new Array();
            var contentLibraryDocuments = new Array();
            
            var offset = 5;
            var offsetIncrement = 5;
            var allAgreementsCount = 0;
            
            var signingUrlRecords;
            var currentSigningUrl;
            var currentSigningEmail;
            var currentAgreementState;
            
            var newRecipient;

            String.prototype.endsWith = function(suffix) {
                return this.indexOf(suffix, this.length - suffix.length) !== -1;
            };
            
            var isiPhone = navigator.userAgent.match(/\(iPhone\)/i) != null;
            var isAndroidPhone = navigator.userAgent.match(/\(Mobile\)/i) != null && navigator.userAgent.match(/\(Android\)/i) != null;
            var isMobilePhone = isiPhone || isAndroidPhone;
            
                    var compiledDetailViewTempl = _.template($("#detailView").html());
                    var compiledEditViewTempl = _.template($("#editView").html());
                    var compiledRemoveViewTempl = _.template($("#removeView").html());
                    var compiledCancelViewTempl = _.template($("#cancelView").html());
                    var compiledEditRecipientsViewTempl = _.template($("#editRecipientsView").html());
                    var compiledEditDocumentsViewTempl = _.template($("#editDocumentsView").html());
                    var compiledDocumentsTemplatesViewTempl = _.template($("#documentsTemplatesView").html());
                    var compiledDocumentsLibrariesViewTempl = _.template($("#documentsLibrariesView").html());
                    var compiledDocumentsContentsViewTempl = _.template($("#documentsContentsView").html());
                    var compiledObjectsSearchViewTempl = _.template($("#objectsSearchView").html());
                    
                    $(document).ready(function() {
                    initSchemaValues();
                    getTemplateDocuments();
                    getLibraryDocuments();
                    getContentDocuments();
                    
                    var idParam = getUrlParameters('id', '', false);
                    var onloadActionParam = getUrlParameters('onloadAction', '', false);
                    getAgreementAndShowEdit(idParam, onloadActionParam);
                        });
                  
function getUrlParameters(parameter, staticURL, decode) {
   var currLocation = (staticURL.length)? staticURL : window.location.search,
       parArr = currLocation.split("?")[1].split("&"),
       returnBool = true;
   
   for(var i = 0; i < parArr.length; i++){
        parr = parArr[i].split("=");
        if(parr[0] == parameter){
            return (decode) ? decodeURIComponent(parr[1]) : parr[1];
            returnBool = true;
        }else{
            returnBool = false;            
        }
   }
   
   if(!returnBool) return false;  
}
            
            function initSchemaValues() {
                            Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.getSchemaValues}',
                                    function(schemaValues, e) { 
                                    parseSchemaValues(schemaValues);}, 
                                {escape:false}); 
            }
            
            function parseSchemaValues(schemaValues) { 
                for(var i = 0; i < schemaValues.languages.length; i++) { 
                    languages[i] = schemaValues.languages[i];
                }
                
                defaultLanguage = schemaValues.defaultLanguage;
                
                for(var i = 0; i < schemaValues.reminders.length; i++) { 
                    reminders[i] = schemaValues.reminders[i];
                }
                
                defaultReminder = schemaValues.defaultReminder;
                
                for(var i = 0; i < schemaValues.signatureOrders.length; i++) { 
                    signatureOrders[i] = schemaValues.signatureOrders[i];
                }
                
                defaultSignatureOrder = schemaValues.defaultSignatureOrder;
                
                for(var i = 0; i < schemaValues.recipientRoles.length; i++) { 
                    recipientRoles[i] = schemaValues.recipientRoles[i];
                }
                
                defaultRecipientRole = schemaValues.defaultRecipientRole;
                
                for(var i = 0; i < schemaValues.recipientTypes.length; i++) { 
                    recipientTypes[i] = schemaValues.recipientTypes[i];
                }
                
                defaultRecipientType = schemaValues.defaultRecipientType;
            }
            
            function getAgreementAndShowEdit(agreementId, onloadAction){
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.getAgreement}',
                                    agreementId,
                                    function(record, e) { 
                                        var agreementName = record.agreement['Name'];
                                        record.agreement['Name'] = $.encoder.encodeForHTML(agreementName);
                                              
                                        this.agreementRecords[record.agreement.Id] = record; 
                                        if( record.agreement[NAMESPACE_FULL + 'Status__c'] == 'Draft' ) { 
                                            showAgreementEdit(record.agreement.Id); 
                                            if( onloadAction == 'Send' ) { 
                                                sendHostedAgreement(record.agreement.Id); 
                                            } 
                                        } else { 
                                            showAgreementDetails(record.agreement.Id); 
                                        } 
                                        
                                        /*window.location.href = '#/agreement/edit/' + agreementId;*/ 
                                    }, 
                                {escape:false});
            }
            
            function getTemplateDocuments(){
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.getTemplateDocuments}',
                                    function(records, e) { 
                                    this.templateDocuments = records;}, 
                                {escape:false}); 
            }
            
            function getLibraryDocuments(){
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.getLibraryDocuments}',
                                    function(records, e) { 
                                    this.libraryDocuments = records;
                                    }, 
                                {escape:false}); 
            }
             
            function getContentDocuments(){
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.getContentDocuments}',
                                    function(contentQueryResult, e) { 
                                    this.contentDocuments = contentQueryResult.contents;
                                    this.contentLibraries = contentQueryResult.libraries;
                                    this.contentLibraryDocuments = contentQueryResult.libraryDocuments;
                                    }, 
                                {escape:false}); 
            }
            
            /*function addAgreement(){
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.addAgreement}',
                                    function(agreementWrapper, e) { 
                                    this.agreementRecords[agreementWrapper.agreement.Id] = agreementWrapper; this.draftAgreements.unshift(agreementWrapper); window.location.href = '#/agreement/edit/' + agreementWrapper.agreement.Id;}, 
                                {escape:false}); 
            }*/
                        
            function queryAccounts(name, agreementWrapper) {
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.queryAccounts}',
                                    name,
                                    function(records, e) {
                                        accounts = new Array();
                                        for(var i = 0; i < records.length; i++) {
                                            accounts[records[i]['Id']] = records[i];
                                            $("#objects-search-list").append('<li><a href="javascript:setAccount(\'' + agreementWrapper['agreement']['Id'] + '\', \'' + records[i]['Id'] + '\');" style="text-decoration: none; color: rgb(60, 61, 62); display: block; font-size: 14px; padding: 14px; word-break: break-all;">' + records[i]['Name'] + '</a></li>');
                                        }
                                    }, 
                                {escape:false}); 
            }
                        
            function queryOpps(name, agreementWrapper) {
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.queryOpps}',
                                    name,
                                    function(records, e) {
                                        opps = new Array();
                                        for(var i = 0; i < records.length; i++) {
                                            opps[records[i]['Id']] = records[i];
                                            $("#objects-search-list").append('<li><a href="javascript:setOpp(\'' + agreementWrapper['agreement']['Id'] + '\', \'' + records[i]['Id'] + '\');" style="text-decoration: none; color: rgb(60, 61, 62); display: block; font-size: 14px; padding: 14px; word-break: break-all;">' + records[i]['Name'] + '</a></li>');
                                        }
                                    }, 
                                {escape:false}); 
            }
                        
            function queryContracts(name, agreementWrapper) {
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.queryContracts}',
                                    name,
                                    function(records, e) {
                                        contracts = new Array();
                                        for(var i = 0; i < records.length; i++) {
                                            contracts[records[i]['Id']] = records[i];
                                            $("#objects-search-list").append('<li><a href="javascript:setContract(\'' + agreementWrapper['agreement']['Id'] + '\', \'' + records[i]['Id'] + '\');" style="text-decoration: none; color: rgb(60, 61, 62); display: block; font-size: 14px; padding: 14px; word-break: break-all;">' + records[i]['ContractNumber'] + '</a></li>');
                                        }
                                    }, 
                                {escape:false}); 
            }           
                                    
            function queryContacts(name, agreementWrapper, recipientIndex) {
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.queryContacts}',
                                    name,
                                    function(records, e) {
                                        contacts = new Array();
                                        for(var i = 0; i < records.length; i++) {
                                            contacts[records[i]['Id']] = records[i];
                                            $("#objects-search-list").append('<li><a href="javascript:setContact(\'' + agreementWrapper['agreement']['Id'] + '\', \'' + recipientIndex + '\', \'' + records[i]['Id'] + '\');" style="text-decoration: none; color: rgb(60, 61, 62); display: block; font-size: 14px; padding: 14px; word-break: break-all;">' + records[i]['Name'] + '</a></li>');
                                        }
                                    }, 
                                {escape:false}); 
            }
                                            
            function queryLeads(name, agreementWrapper, recipientIndex) {      
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.queryLeads}',
                                    name,
                                    function(records, e) {
                                        leads = new Array();
                                        for(var i = 0; i < records.length; i++) {
                                            leads[records[i]['Id']] = records[i];
                                            $("#objects-search-list").append('<li><a href="javascript:setLead(\'' + agreementWrapper['agreement']['Id'] + '\', \'' + recipientIndex + '\', \'' + records[i]['Id'] + '\');" style="text-decoration: none; color: rgb(60, 61, 62); display: block; font-size: 14px; padding: 14px; word-break: break-all;">' + records[i]['Name'] + '</a></li>');
                                        }
                                    }, 
                                {escape:false}); 
            }
                                             
            function queryUsers(name, agreementWrapper, recipientIndex) {
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.queryUsers}',
                                    name,
                                    function(records, e) {
                                        users = new Array();
                                        for(var i = 0; i < records.length; i++) {
                                            users[records[i]['Id']] = records[i];
                                            $("#objects-search-list").append('<li><a href="javascript:setUser(\'' + agreementWrapper['agreement']['Id'] + '\', \'' + recipientIndex + '\', \'' + records[i]['Id'] + '\');" style="text-decoration: none; color: rgb(60, 61, 62); display: block; font-size: 14px; padding: 14px; word-break: break-all;">' + records[i]['Name'] + '</a></li>');
                                        }
                                    }, 
                                {escape:false}); 
            }
                                               
            function setAccount(agreementId, accountId) {
                var account = accounts[accountId]; 
                var agreementWrapper = agreementRecords[ agreementId ];
                agreementWrapper['agreement'][NAMESPACE_FULL + 'Account__c'] = accountId;
                agreementWrapper['agreement'][NAMESPACE_FULL + 'Account__r'] = account;
                
                window.location.href = '#/agreement/edit/' + agreementWrapper['agreement']['Id'];
            }
            
            function searchAccounts(agreementId) {
                var agreementWrapper = agreementRecords[ agreementId ];
                var name = $('#objects-search-input').val();
                $('ul#objects-search-list li:not(:first)').remove();        
                queryAccounts(name, agreementWrapper);
            }
                                               
            function setOpp(agreementId, oppId) {
                var opp = opps[oppId]; 
                var agreementWrapper = agreementRecords[ agreementId ];
                agreementWrapper['agreement'][NAMESPACE_FULL + 'Opportunity__c'] = oppId;
                agreementWrapper['agreement'][NAMESPACE_FULL + 'Opportunity__r'] = opp;
                
                window.location.href = '#/agreement/edit/' + agreementWrapper['agreement']['Id'];
            }
            
            function searchOpps(agreementId) {
                var agreementWrapper = agreementRecords[ agreementId ];
                var name = $('#objects-search-input').val();
                $('ul#objects-search-list li:not(:first)').remove();        
                queryOpps(name, agreementWrapper);
            }
                                               
            function setContract(agreementId, contractId) {
                var contract = contracts[contractId]; 
                var agreementWrapper = agreementRecords[ agreementId ];
                agreementWrapper['agreement'][NAMESPACE_FULL + 'Contract__c'] = contractId;
                agreementWrapper['agreement'][NAMESPACE_FULL + 'Contract__r'] = contract;
                
                window.location.href = '#/agreement/edit/' + agreementWrapper['agreement']['Id'];
            }
            
            function searchContracts(agreementId) {
                var agreementWrapper = agreementRecords[ agreementId ];
                var name = $('#objects-search-input').val();
                $('ul#objects-search-list li:not(:first)').remove();        
                queryContracts(name, agreementWrapper);
            }
                                               
            function setContact(agreementId, recipientIndex, contactId) {
                var contact = contacts[contactId]; 
                var agreementWrapper = agreementRecords[ agreementId ];
                var recipient;
                if( recipientIndex != -1 ) {
                    recipient = agreementWrapper.recipients[recipientIndex];
                } else {
                    recipient = newRecipient;
                }
                
                recipient[NAMESPACE_FULL + 'Contact__c'] = contactId;
                recipient[NAMESPACE_FULL + 'Contact__r'] = contact;
                
                window.location.href = '#/agreement/edit/' + agreementWrapper['agreement']['Id'] + '/recipients/edit/' + recipientIndex;
            }
            
            function searchContacts(agreementId, recipientIndex) {
                var agreementWrapper = agreementRecords[ agreementId ];
                var name = $('#objects-search-input').val();
                $('ul#objects-search-list li:not(:first)').remove();        
                queryContacts(name, agreementWrapper, recipientIndex);
            }
                                               
            function setLead(agreementId, recipientIndex, leadId) {
                var lead = leads[leadId]; 
                var agreementWrapper = agreementRecords[ agreementId ];
                var recipient;
                if( recipientIndex != -1 ) {
                    recipient = agreementWrapper.recipients[recipientIndex];
                } else {
                    recipient = newRecipient;
                }
                
                recipient[NAMESPACE_FULL + 'Lead__c'] = leadId;
                recipient[NAMESPACE_FULL + 'Lead__r'] = lead;
                
                window.location.href = '#/agreement/edit/' + agreementWrapper['agreement']['Id'] + '/recipients/edit/' + recipientIndex;
            }
            
            function searchLeads(agreementId, recipientIndex) {
                var agreementWrapper = agreementRecords[ agreementId ];
                var name = $('#objects-search-input').val();
                $('ul#objects-search-list li:not(:first)').remove();        
                queryLeads(name, agreementWrapper, recipientIndex);
            }
                                               
            function setUser(agreementId, recipientIndex, userId) {
                var user = users[userId]; 
                var agreementWrapper = agreementRecords[ agreementId ];
                var recipient;
                if( recipientIndex != -1 ) {
                    recipient = agreementWrapper.recipients[recipientIndex];
                } else {
                    recipient = newRecipient;
                }
                
                recipient[NAMESPACE_FULL + 'User__c'] = userId;
                recipient[NAMESPACE_FULL + 'User__r'] = user;
                
                window.location.href = '#/agreement/edit/' + agreementWrapper['agreement']['Id'] + '/recipients/edit/' + recipientIndex;
            }
            
            function searchUsers(agreementId, recipientIndex) {
                var agreementWrapper = agreementRecords[ agreementId ];
                var name = $('#objects-search-input').val();
                $('ul#objects-search-list li:not(:first)').remove();        
                queryUsers(name, agreementWrapper, recipientIndex);
            }
                                                
            function loadMoreAgreements() {
                offset += offsetIncrement;
                getAllAgreements();
            }
                                  
            /*function navToDocumentsEdit(agreementId) {
                pullAgreementWrapper(agreementId);
                
                window.location.href = '#/agreement/edit/' + agreementId + '/documents';
            }
                       
            function navToDocumentsView(agreementId) {
                window.location.href = '#/agreement/' + agreementId + '/documents';
            }*/          
            
            /*function navToRecipientsEdit(agreementId) {
                pullAgreementWrapper(agreementId);          
                window.location.href = '#/agreement/edit/' + agreementId + '/recipients';
            }
            
                        
            function navToRecipientsView(agreementId) {
                window.location.href = '#/agreement/' + agreementId + '/recipients';
            }*/
            
            function closeViewAgreement() {
                $('#viewAgreement').hide('fast', function() {});
                $('#sendConfirmation').hide('fast', function() {});
                $('#closeButtonSection').hide('fast', function() {});      
                $('#viewAgreementContent').show('fast', function() {});
                
                if( isMobilePhone ) {
                    $('#es-buttons-phone-bottom').show('fast', function() {});
                } else {
                    $('#bottom-view-action-buttons').show('fast', function() {});
                } 
            }            
            
            function closeSendConfirmation(agreementId) {
                var agreementWrapper = agreementRecords[ agreementId ];
            
                $('#sendConfirmation').hide('fast', function() {});
                $('#closeButtonSection').hide('fast', function() {});
                $('#closeButtonSectionBottom').hide('fast', function() {});
                
                window.location.href = '#/agreement/' + agreementWrapper.agreement.Id;
            }
            
            function getContentLibrary(contentDocumentId) {
                for(var i = 0; i < contentLibraryDocuments.length; i++) {
                    if( contentLibraryDocuments[i]['ContentDocumentId'] == contentDocumentId ) {
                        return contentLibraryDocuments[i]['ContentWorkspace'];
                    }
                }
            }
            
            function addContentDocument(agreementId) {
                pullAgreementWrapper(agreementId);
                
                var libraryId;
                if( contentDocuments.length > 0 ) {
                    libraryId = 'Chatter_Files';
                }
                
                window.location.href = '#/agreement/edit/' + agreementId + '/documents/contents/' + libraryId;
            }
            
            function addLibraryDocument(agreementId) {
                pullAgreementWrapper(agreementId);
                
                var folderId;
                if( libraryDocuments.length > 0 ) {
                    folderId = libraryDocuments[0]['Folder']['Id'];
                }
                
                window.location.href = '#/agreement/edit/' + agreementId + '/documents/libraries/' + folderId;
            }
              
            function addTemplateDocument(agreementId) {           
                pullAgreementWrapper(agreementId);
                
                window.location.href = '#/agreement/edit/' + agreementId + '/documents/templates';
            }
            
            function addRecipient(agreementId) {
                pullAgreementWrapper(agreementId);
                
                var agreementWrapper = agreementRecords[ agreementId ];
                var recipient = new Object();
                recipient[NAMESPACE_FULL + 'Recipient_Role__c'] = defaultRecipientRole;
                recipient[NAMESPACE_FULL + 'Recipient_Type__c'] = defaultRecipientType;
                recipient[NAMESPACE_FULL + 'Order_Number__c'] = agreementWrapper.recipients.length + 1;
                recipient[NAMESPACE_FULL + 'Agreement__c'] = agreementId;
        
                //agreementWrapper.recipients.push(recipient);
                newRecipient = recipient;
                
                window.location.href = '#/agreement/edit/' + agreementWrapper.agreement.Id + '/recipients/edit/-1';
            }
            
            function deleteRecipient(agreementId, recipientIndex) {
                var agreementWrapper = agreementRecords[ agreementId ];
                var deletedRecipient = agreementWrapper.recipients.splice(recipientIndex, 1)[0];
                
                if( deletedRecipient['Id'] ) {
                    agreementWrapper.deletedRecipients.push(deletedRecipient);
                }
                
                for(var i = recipientIndex; i < agreementWrapper.recipients.length; i++) { 
                    agreementWrapper.recipients[i][NAMESPACE_FULL + 'Order_Number__c'] = parseInt(recipientIndex) + 1;
                }
                
                setRecipientsList(agreementWrapper, 'edit');
                
                window.location.href = '#/agreement/edit/' + agreementWrapper.agreement.Id;
            }
            
            function saveRecipientEdit(agreementId, recipientIndex) {
                if( recipientIndex == -1 ) {
                    var agreementWrapper = agreementRecords[ agreementId ];
                    agreementWrapper.recipients.push(newRecipient);
                    recipientIndex = agreementWrapper.recipients.length - 1;
                }
                
                saveRecipient(agreementId, recipientIndex);
                
                window.location.href = '#/agreement/edit/' + agreementId;
            }
            
            function saveRecipient(agreementId, recipientIndex) {
                var agreementWrapper = agreementRecords[ agreementId ];
                var recipient = recipientIndex == -1 ? newRecipient : agreementWrapper.recipients[recipientIndex];
                recipient[NAMESPACE_FULL + 'Recipient_Role__c'] = $('#recipientRoleSelect').val();
                recipient[NAMESPACE_FULL + 'Recipient_Type__c'] = $('#recipientTypeSelect').val();
                recipient[NAMESPACE_FULL + 'Email_Address__c'] = $('#recipientEmailValue').val();
            }
            
            function deleteDocument(agreementId, documentIndex) {
                var agreementWrapper = agreementRecords[ agreementId ];
                var deletedDocument = agreementWrapper.documents.splice(documentIndex, 1)[0];
                
                if( ( deletedDocument['attachment'] && deletedDocument['attachment']['Id'] ) ||
                    ( deletedDocument['libraryTemplate'] && deletedDocument['libraryTemplate']['Id'] ) ) {
                    agreementWrapper.deletedDocuments.push(deletedDocument);
                }
                
                setDocumentsList(agreementWrapper, 'edit');
                
                window.location.href = '#/agreement/edit/' + agreementWrapper.agreement.Id;
            }
            
            function saveDocumentEdit(agreementId, documentIndex) {
                window.location.href = '#/agreement/edit/' + agreementId;
            }
            
            function storeContentDocument(agreementId, contentId) {
                var contentDocument;
                for(var i = 0; i < contentDocuments.length; i++) { 
                    if( contentDocuments[i]['Id'] == contentId ) {
                        contentDocument = contentDocuments[i];
                        break;
                    }
                }
                var agreementWrapper = agreementRecords[ agreementId ];
                
                var documentWrapper = new Object();
                documentWrapper['contentId'] = contentDocument['Id'];
                documentWrapper['name'] = contentDocument['Title'];
                
                var fileType = contentDocument['FileType'];
                if(fileType == 'PDF' ) {
                    documentWrapper['documentType'] = 'pdf';
                } else if(fileType == 'WORD' ) {
                    documentWrapper['documentType'] = 'doc';
                } else if(fileType == 'PPT' ) {
                    documentWrapper['documentType'] = 'ppt';
                } else if(fileType == 'XLS' ) {
                    documentWrapper['documentType'] = 'xls';
                } else if(fileType == 'JPG' ) {
                    documentWrapper['documentType'] = 'jpg';
                }
            
                agreementWrapper.documents.push(documentWrapper);
                
                window.location.href = '#/agreement/edit/' + agreementId;
            }
                        
            function storeLibraryDocument(agreementId, documentId) {
                var libraryDocument;
                for(var i = 0; i < libraryDocuments.length; i++) { 
                    if( libraryDocuments[i]['Id'] == documentId ) {
                        libraryDocument = libraryDocuments[i];
                        break;
                    }
                }
                var agreementWrapper = agreementRecords[ agreementId ];
                
                var documentWrapper = new Object();
                documentWrapper['documentId'] = libraryDocument['Id'];
                documentWrapper['name'] = libraryDocument['Name'];
                documentWrapper['documentType'] = libraryDocument['Type'];
            
                agreementWrapper.documents.push(documentWrapper);
                
                window.location.href = '#/agreement/edit/' + agreementId;
            }
            
            function storeTemplateDocument(agreementId, templateIndex) {
                var agreementWrapper = agreementRecords[ agreementId ];
                var templateDocument = templateDocuments[templateIndex];
                
                var documentWrapper = new Object();
                
                var agreementTemplateDocument = new Object();
                agreementTemplateDocument['Name'] = templateDocument.name;
                agreementTemplateDocument[NAMESPACE_FULL + 'Agreement__c'] = agreementId;
                agreementTemplateDocument[NAMESPACE_FULL + 'Document_Key__c'] = templateDocument.documentKey;
                agreementTemplateDocument[NAMESPACE_FULL + 'Last_Modified__c'] = templateDocument.modifiedDate;
                
                agreementTemplateDocument[NAMESPACE_FULL + 'Type__c'] = '';

                if( templateDocument.isDocument ) {
                    agreementTemplateDocument[NAMESPACE_FULL + 'Type__c'] += 'Document';
                    documentWrapper['isDocument'] = true;
                }
            
                if( templateDocument.isFormFieldLayer ) {
                    agreementTemplateDocument[NAMESPACE_FULL + 'Type__c'] += ( agreementTemplateDocument[NAMESPACE_FULL + 'Type__c'] == '' ?  'Form Field Layer' : '; Form Field Layer' );
                    documentWrapper['isFormFieldLayer'] = true;
                }
                
                documentWrapper['libraryTemplate'] = agreementTemplateDocument;
                documentWrapper['name'] = templateDocument.name;
            
                agreementWrapper.documents.push(documentWrapper);
                
                window.location.href = '#/agreement/edit/' + agreementId;
            }
            
            function viewAgreement(agreementId) {
                /*$('#viewAgreementContent').hide('fast', function() {});
                if( isMobilePhone ) {
                    $('#es-buttons-phone-bottom').hide('fast', function() {});
                } else {
                    $('#bottom-view-action-buttons').hide('fast', function() {});
                } 
                $('#progressSpinner').show('fast', function() {});*/
                
                var agreementWrapper = agreementRecords[ agreementId ];
                var url = '{! baseUrl }/salesforce-web/page/public/viewAgreement?Version={! JSENCODE(appVersion) }&namespace={! JSENCODE(appNamespace) }&Agreement_ID=' + agreementWrapper.agreement.Id + '&session={!$Api.Session_ID}&organizationId={!$Organization.Id}&server={!$Api.Partner_Server_URL_70}';
                
                /*$('#viewAgreementFrame').attr('src', url);
                $('#progressSpinner').hide('fast', function() {});
                $('#viewAgreement').show('fast', function() {});
                $('#closeButtonSection').show('fast', function() {});
                $('#closeButtonSectionBottom').show('fast', function() {});*/
                
                sforce.one.navigateToURL(url);
            }
            
            function confirmAgreementRemove(agreementId) {          
                var agreementWrapper = agreementRecords[ agreementId ];
                var reason = $('#removeAgreementReason').val();
                
                $('#removeContent').hide('fast', function() {});
                $('#removeProgressSpinner').show('fast', function() {});
                
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.removeAgreement}',
                                    agreementWrapper,
                                    reason,
                                    function(e) { sforce.one.navigateToURL('/apex/' + NAMESPACE_FULL + 'AgreementMobileTab'); }, 
                                {escape:false});
            }
            
            function removeAgreement(agreementId) {
                $('#saveAgreementContent').hide('fast', function() {});
                $('#es-buttons-bottom').hide('fast', function() {});
                $('#es-buttons-phone-bottom').hide('fast', function() {});
                $('#progressSpinner').show('fast', function() {});
                
                var agreementWrapper = agreementRecords[ agreementId ];
                
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.removeAgreement}',
                                    agreementWrapper,
                                    null,
                                    function(e) { sforce.one.navigateToURL('/apex/' + NAMESPACE_FULL + 'AgreementMobileTab'); }, 
                                {escape:false});
            }            
            
            function confirmAgreementCancel(agreementId) {          
                var agreementWrapper = agreementRecords[ agreementId ];
                var reason = $('#cancelAgreementReason').val();
                
                $('#cancelContent').hide('fast', function() {});
                $('#cancelContentButtons').hide('fast', function() {});
                $('#cancelProgressSpinner').show('fast', function() {});
                
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.cancelAgreement}',
                                    agreementWrapper,
                                    reason,
                                    function(e) {
                                        agreementWrapper.agreement[namespace + '__Status__c'] = 'Cancelled / Declined';
                                        showAgreementDetails(agreementId);
                                    }, 
                                {escape:false}); 
            }

            function updateAgreement(agreementId) {
                $('#viewAgreementContent').hide('fast', function() {});
                if( isMobilePhone ) {
                    $('#es-buttons-phone-bottom').hide('fast', function() {});
                } else {
                    $('#bottom-view-action-buttons').hide('fast', function() {});
                } 
                $('#progressSpinner').show('fast', function() {});
                
                var agreementWrapper = agreementRecords[ agreementId ];
                
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.updateAgreement}',
                                    agreementWrapper,
                                    function(result, event) { 
                                        if( event.status ) { 
                                            getAgreementAndShowEdit(agreementId, null);
                                        } else {  
                                            $('#progressSpinner').hide('fast', function() {}); 
                                            $('#viewAgreementContent').show('fast', function() {});
                                            if( isMobilePhone ) {
                                                $('#es-buttons-phone-bottom').show('fast', function() {});
                                            } else {
                                                $('#bottom-view-action-buttons').show('fast', function() {});
                                            } 
                                        
                                            $('#agreementErrorMessage').text( event.message ); 
                                            $('#agreementErrorPanel').show('slow', function() {});
                                        } 
                                    }, 
                                {escape:false}); 
            }
            
            function sendReminder(agreementId) {
                $('#viewAgreementContent').hide('fast', function() {});
                if( isMobilePhone ) {
                    $('#es-buttons-phone-bottom').hide('fast', function() {});
                } else {
                    $('#bottom-view-action-buttons').hide('fast', function() {});
                } 
                $('#progressSpinner').show('fast', function() {});
                
                var agreementWrapper = agreementRecords[ agreementId ];
                
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.sendReminder}',
                                    agreementWrapper,
                                    function(result, event) { 
                                        $('#progressSpinner').hide('fast', function() {}); 
                                        $('#viewAgreementContent').show('fast', function() {});
                                        if( isMobilePhone ) {
                                            $('#es-buttons-phone-bottom').show('fast', function() {});
                                        } else {
                                            $('#bottom-view-action-buttons').show('fast', function() {});
                                        } 
                                        if( event.status ) { 
                                            $('#agreementInfoMessage').text( 'Reminder sent to the recipient.' ); 
                                            $('#agreementInfoPanel').show('slow', function() {}); 
                                        } else {  
                                            $('#agreementErrorMessage').text( event.message ); 
                                            $('#agreementErrorPanel').show('slow', function() {});
                                        } 
                                    }, 
                                {escape:false}); 
            }

            function pollSigningUrls(agreementWrapper) {
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.retrieveSigningUrls}',
                                agreementWrapper,
                                    function(records, event) {
                                        if( event.status ) {
                                            if( records ) {
                                                //Commented out to test open v3 signing in iframe
                                                showAgreementDetails( agreementWrapper.agreement.Id );
                                                if( records.length > 1 ) {
                                                    showChooseSignersDialog(records);
                                                } else {
                                                    currentSigningEmail = records[0]['email'];
                                                    currentSigningUrl = records[0]['esignUrl'];
                                                    showConfirmPassDialog();
                                                }
                                                                                      
                                               //Put in to test open v3 signing in iframe 
                                               /*$('#hostSigningAgreementFrame').attr('src', records[0]['esignUrl'])
                                               $('#hostSigningAgreement').show('fast', function() {});
                                               $('#closeButtonSection').show('fast', function() {});
                                               $('#closeButtonSectionBottom').show('fast', function() {});*/
                                            } else {
                                                setTimeout(function() { pollSigningUrls(agreementWrapper); }, 500);
                                            }
                                        } else { 
                                            setTimeout(function() { pollSigningUrls(agreementWrapper); }, 500);
                                        }
                                    }, 
                                {escape:false}); 
            }
                        
            function pollSigningUrl(agreementWrapper) {
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.retrieveSigningUrl}',
                                agreementWrapper,
                                    function(url, e) {
                                    if( url ) {
                                        /*$('#progressSpinner').hide('fast', function() {});
                                        $('#sendConfirmationFrame').attr('src', url)
                                        $('#sendConfirmation').show('fast', function() {});
                                        $('#closeButtonSection').show('fast', function() {});*/
 
                                        closeSendConfirmation( agreementWrapper.agreement['Id'] ); 
                                        
                                        sforce.one.navigateToURL(url);
                                    } else {
                                        setTimeout(function() { pollSigningUrl(agreementWrapper); }, 500);
                                    } }, 
                                {escape:false}); 
            }

            function sendHostedButtonAgreement(agreementId) {
                var agreementWrapper = agreementRecords[ agreementId ];
                agreementWrapper.agreement[namespace + '__Enable_Hosted_Signing__c'] = true;
                sendHostedAgreement(agreementId);
            }
            
            function sendHostedAgreement(agreementId) {
                var agreementWrapper = agreementRecords[ agreementId ];
                if( agreementWrapper.agreement[namespace + '__Status__c'] == 'Draft' ) {        
                    sendAgreement(agreementId);
                } else {
                    $('#agreementErrorPanel').hide('fast', function() {});
                    $('#viewAgreementContent').hide('fast', function() {});
                    if( isMobilePhone ) {
                        $('#es-buttons-phone-bottom').hide('fast', function() {});
                    } else {
                        $('#bottom-view-action-buttons').hide('fast', function() {});
                    } 
                    $('#progressSpinner').show('fast', function() {});
                    
                    pollSigningUrls(agreementWrapper);
                }
            }
            
            function progressIndicatorBar(stageNumber) {
                var isStop = stageNumber > 10;
                if( isStop ) {
                    return;
                }
                
                var nextStageNumber = stageNumber + 1;
                
                var curClass = 'size-' + stageNumber + 'of10';
                var nextClass = 'size-' + nextStageNumber + 'of10';
                        
                $('#progressBarElement').removeClass(curClass);
                $('#progressBarElement').addClass(nextClass);
                    
                setTimeout('progressIndicatorBar(' + nextStageNumber + ')', 1000);
            }             
            
            function sendAgreement(agreementId) {
                $('#agreementErrorPanel').hide('fast', function() {});
                $('#saveAgreementContent').hide('fast', function() {});            
                $('#es-buttons-bottom').hide('fast', function() {});
                $('#es-buttons-phone-bottom').hide('fast', function() {});
                $('#progressSpinner').show('fast', function() {});
                
                progressIndicatorBar(0);

                var agreementWrapper = agreementRecords[ agreementId ];  
                
                var isHosted = agreementWrapper.agreement[namespace + '__Enable_Hosted_Signing__c'];
                var isAuthoring = agreementWrapper.agreement[namespace + '__Authoring__c'];
                var isSenderSignsFirst = agreementWrapper.agreement[namespace + '__SenderSigns__c'] && agreementWrapper.agreement[namespace + '__SignatureOrder__c'] == 'I sign, then the Recipient signs';
                 
                agreementWrapper = pullAgreementWrapper(agreementId);
                
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.saveAgreement2}',
                                    agreementWrapper,
                                    function(result, event) { 
                                    
                                    copySavedAgreementWrapper(agreementWrapper, result);

                                    if( event.type === 'exception' ) {
                                        $('#progressSpinner').hide('fast', function() {});
                                        
                                        $('#agreementErrorMessage').text( event.message );
                                        
                                        $('#saveAgreementContent').show('fast', function() {});                          
                                        $('#es-buttons-bottom').show('fast', function() {});
                                        $('#es-buttons-phone-bottom').show('fast', function() {});
                                        $('#agreementErrorPanel').show('slow', function() {});
                                        
                                        return;
                                    }
                                    
                                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.sendAgreement}',
                                    agreementWrapper,
                                    function(result, e) { 
                      
                                    if( result.errorMessage ) {
                                        $('#progressSpinner').hide('fast', function() {});
                                        
                                        $('#agreementErrorMessage').text( result.errorMessage );
                                        
                                        $('#saveAgreementContent').show('fast', function() {});                          
                                        $('#es-buttons-bottom').show('fast', function() {});
                                        $('#es-buttons-phone-bottom').show('fast', function() {});
                                        $('#agreementErrorPanel').show('slow', function() {});
                                        
                                        return;
                                    }
                                    
                                    agreementWrapper.agreement[namespace + '__Status__c'] = 'Out for Signature';
                                    agreementWrapper.agreement[namespace + '__Document_Key__c'] = result.documentKey;
                                    $('#edit-status-span').text('Out for Signature');
                                    $('#edit-status-mobile-span').text('Out for Signature');
                                    
                                    if( !isHosted || isAuthoring ) {
                                        $('#progressSpinner').hide('fast', function() {});
                                        
                                        closeSendConfirmation( agreementWrapper.agreement['Id'] );
                                        
                                        /*$('#sendConfirmationFrame').attr('src', result.url)
                                        $('#sendConfirmation').show('fast', function() {});
                                        $('#closeButtonSection').show('fast', function() {});
                                        $('#closeButtonSectionBottom').show('fast', function() {});*/
        
                                        if( !isAuthoring && !isSenderSignsFirst ) {
                                            setTimeout(function(){showLogoutPanel();}, 5000);   
                                        }
                                        
                                        sforce.one.navigateToURL(result.url);
                                    } else {
                                        pollSigningUrls(agreementWrapper);
                                    } }, 
                                {escape:false}); 
                                    
                                    }, 
                                {escape:false});
                

            }
            
            function showLogoutPanel() {
                $( '#logout-panel' ).append( '<iframe height="0" width="0" src="https://secure.echosign.com/public/logout" style="visibility:hidden;display:none"></iframe>' );
                                      
                $('#logout-panel').show('fast', function() {});
            }
            
            function saveAgreement(agreementId) {
                $('#agreementErrorPanel').hide('fast', function() {});
                $('#saveAgreementContent').hide('fast', function() {});
                $('#es-buttons-bottom').hide('fast', function() {});
                $('#es-buttons-phone-bottom').hide('fast', function() {});
                $('#saveProgressSpinner').show('fast', function() {});
                
                var agreementWrapper = pullAgreementWrapper(agreementId);
                
                Visualforce.remoting.Manager.invokeAction(
                                '{!$RemoteAction.AgreementMobileController.saveAgreement2}',
                                    agreementWrapper,
                                    function(savedAgreementWrapper, e) {
                                        copySavedAgreementWrapper(agreementWrapper, savedAgreementWrapper);
                                        $('#saveProgressSpinner').hide('fast', function() {});
                                        $('#saveAgreementContent').show('fast', function() {});
                                    }, 
                                {escape:false}); 
            }
            
            function copySavedAgreementWrapper(agreementWrapper, savedAgreementWrapper) {
                for(var i = 0; i < savedAgreementWrapper.recipients.length; i++) { 
                    agreementWrapper.recipients[i].Id = savedAgreementWrapper.recipients[i].Id;
                }
                
                for(var i = 0; i < savedAgreementWrapper.documents.length; i++) { 
                    agreementWrapper.documents[i]['libraryTemplate'] = savedAgreementWrapper.documents[i]['libraryTemplate'];
                    agreementWrapper.documents[i]['attachment'] = savedAgreementWrapper.documents[i]['attachment'];
                }
                
                agreementWrapper.deletedRecipients = new Array();
                agreementWrapper.deletedDocuments = new Array();
            }
            
            function pullAgreementWrapper(agreementId) {
                var agreementWrapper = agreementRecords[agreementId];
                
                agreementWrapper['agreement']['Id'] = agreementWrapper.agreement.Id;
                agreementWrapper['agreement'][NAMESPACE_FULL + 'Document_Key__c'] = agreementWrapper.agreement[NAMESPACE_FULL + 'Document_Key__c'];
                agreementWrapper['agreement']['Name'] = $('#agreementNameValue').val();
                agreementWrapper['agreement'][NAMESPACE_FULL + 'Message__c'] = $('#agreementMessageValue').val();
                agreementWrapper['agreement'][NAMESPACE_FULL + 'Cc__c'] = $('#agreementCcValue').val();
                agreementWrapper['agreement'][NAMESPACE_FULL + 'RemindRecipient__c'] = $('#remindersSelect').val();
                agreementWrapper['agreement'][NAMESPACE_FULL + 'SignatureOrder__c'] = $('#senderSignatureSelect').val();
                agreementWrapper['agreement'][NAMESPACE_FULL + 'AgreementLocale__c'] = $('#languageSelect').val();
                //agreementWrapper['agreement'][NAMESPACE_FULL + 'Enable_Hosted_Signing__c'] = $('#hostedCheckbox').is(":checked");
                
                if( agreementWrapper['agreement'][NAMESPACE_FULL + 'RemindRecipient__c'] == '' ) {
                    agreementWrapper['agreement'][NAMESPACE_FULL + 'Enable_Automatic_Reminders__c'] = false;
                } else {
                    agreementWrapper['agreement'][NAMESPACE_FULL + 'Enable_Automatic_Reminders__c'] = true;
                }
                
                if( agreementWrapper['agreement'][NAMESPACE_FULL + 'SignatureOrder__c'] == '' ) {
                    agreementWrapper['agreement'][NAMESPACE_FULL + 'SenderSigns__c'] = false;
                } else {
                    agreementWrapper['agreement'][NAMESPACE_FULL + 'SenderSigns__c'] = true;
                }
                
                var expirationRaw = $('#agreementExpirationInput').val();  
                if( expirationRaw != '' ) {
                    var expiration = new Date(expirationRaw);
                    agreementWrapper['signingDeadlineYear'] = expiration.getFullYear();
                    agreementWrapper['signingDeadlineMonth'] = expiration.getMonth();
                    agreementWrapper['signingDeadlineDay'] = expiration.getDate();
                } else {
                    agreementWrapper['signingDeadlineYear'] = null;
                    agreementWrapper['signingDeadlineMonth'] = null;
                    agreementWrapper['signingDeadlineDay'] = null;
                }
                
                return agreementWrapper;
            }            
            
            /*function showAgreements(records) {               
                agreementRecords.length = 0;   
                var draftIndex = 0, inProgressIndex = 0, completedIndex = 0, allIndex = 0;                             
                for(var i = 0; i < records.length; i++) { 
                    agreementRecords[records[i].agreement.Id] = records[i];
                    allAgreements[allIndex++] = records[i];
                    
                    var agreementStatus = records[i].agreement[namespace + '__Status__c'];
                    if( agreementStatus == 'Draft' || agreementStatus == 'Pre-Send' || agreementStatus == 'Send in Progress' ) {
                        draftAgreements[draftIndex++] = records[i];
                    } else if( agreementStatus == 'Out for Signature' || agreementStatus == 'Waiting for Counter-Signature' || agreementStatus == 'Waiting for Counter-Approval' || agreementStatus == 'Out for Approval' ) {
                        inProgressAgreements[inProgressIndex++] = records[i];
                    } else if( agreementStatus == 'Signed' || agreementStatus == 'Approved' || agreementStatus == 'Cancelled / Declined' || agreementStatus == 'Expired' || agreementStatus == 'Aborted' ) {
                        completedAgreements[completedIndex++] = records[i];
                    } else {
                        draftAgreements[draftIndex++] = records[i];
                    }
                }

                $('#mainContainer').empty();
                $('#mainContainer').append(compiledListViewTempl({agreements : allAgreements}));
                //$('#mainContainer').append(compiledListViewTempl({draftAgreements : draftAgreements}));
                //$('#mainContainer').append(compiledListViewTempl({inProgressAgreements : inProgressAgreements}));
                //$('#mainContainer').append(compiledListViewTempl({completedAgreements : completedAgreements}));
                $(document).trigger('onTemplateReady');
                
                if( offset >= allAgreementsCount ) {
                    $('#loadMoreAgreementsButton').hide('slow', function() {});
                }            
            }*/
                        
            function showAgreementDetails(recordId) {
                currentAgreementState = 'view';
                var agreement = agreementRecords[recordId];
                
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledDetailViewTempl({agreement: agreement}));

                $('#hostedCheckbox').val( agreement.agreement[namespace + '__Enable_Hosted_Signing__c'] );
                
                setRecipientsList(agreement, 'view');
                setDocumentsList(agreement, 'view');
                setEventsList(agreement);         
                showViewButtons();
                
                var agreementStatus = agreement.agreement[namespace + '__Status__c'];
                if( agreementStatus == 'Out for Signature' || agreementStatus == 'Waiting for Counter-Signature' || agreementStatus == 'Waiting for Counter-Approval' || agreementStatus == 'Out for Approval' ) {
                    $('#inProgressStatusBar').show('slow', function() {});
                } else if( agreementStatus == 'Signed' || agreementStatus == 'Approved' ) {
                    $('#successStatusBar').show('slow', function() {});
                    $('#sendReminderButton').hide('fast', function() {});
                    $('#cancelAgreementButton').hide('fast', function() {});
                    $('#hostedSignButton').hide('fast', function() {});
                    $('#sendReminderButtonBottom').hide('fast', function() {});
                    $('#cancelAgreementButtonBottom').hide('fast', function() {});
                    $('#hostedSignButtonBottom').hide('fast', function() {});
                    
                    $('#sendReminderButtonMobile').hide('fast', function() {});
                    $('#cancelAgreementButtonMobile').hide('fast', function() {});
                    $('#hostedSignButtonPhone').hide('fast', function() {});
                    $('#sendReminderButtonMobileBottom').hide('fast', function() {});
                    $('#cancelAgreementButtonMobileBottom').hide('fast', function() {});
                    $('#hostedSignButtonPhoneBottom').hide('fast', function() {});
                } else if( agreementStatus == 'Cancelled / Declined' || agreementStatus == 'Expired' || agreementStatus == 'Aborted' ) {
                    $('#failedStatusBar').show('slow', function() {});
                    $('#sendReminderButton').hide('fast', function() {});
                    $('#cancelAgreementButton').hide('fast', function() {});
                    $('#hostedSignButton').hide('fast', function() {});
                    $('#sendReminderButtonBottom').hide('fast', function() {});
                    $('#cancelAgreementButtonBottom').hide('fast', function() {});
                    $('#hostedSignButtonBottom').hide('fast', function() {});
                    
                    $('#sendReminderButtonMobile').hide('fast', function() {});
                    $('#cancelAgreementButtonMobile').hide('fast', function() {});
                    $('#hostedSignButtonPhone').hide('fast', function() {});
                    $('#sendReminderButtonMobileBottom').hide('fast', function() {});
                    $('#cancelAgreementButtonMobileBottom').hide('fast', function() {});
                    $('#hostedSignButtonPhoneBottom').hide('fast', function() {});
                } else {
                    $('#inProgressStatusBar').show('slow', function() {});
                }
            }
            
            function showEditButtons() {
                hideAllButtons();
                
                //var orientation = window.orientation;
                //var isPortrait = ( orientation == -90 || orientation == 90 );
                if( isMobilePhone ) {
                    $('#agreement-header-panel-phone').css('display', 'block');
                    $('#es-buttons-phone-top').css('display', 'block');
                    $('#es-buttons-phone-bottom').css('display', 'block');
                    
                    if( {!isHostedEnabled} ) {
                        $('#hostedSignButtonPhone').show('fast', function() {});
                        $('#hostedSignButtonPhoneBottom').show('fast', function() {});
                    }
                } else {
                    $('#agreement-header-panel').css('display', 'block');
                    $('#es-buttons-top').css('display', 'block');   
                    $('#es-buttons-bottom').css('display', 'block');    
                    
                    if( {!isHostedEnabled} ) {
                        $('#hostedSignButton').show('fast', function() {});
                        $('#hostedSignButtonBottom').show('fast', function() {});
                    }
                }
            }
            
            function showViewButtons() {
                hideAllButtons();
                    
                //var orientation = window.orientation;
                //var isPortrait = ( orientation == -90 || orientation == 90 );
                if( isMobilePhone ) {           
                    $('#agreement-header-panel-phone').css('display', 'block');
                    $('#es-buttons-phone-top').css('display', 'block');
                    $('#es-buttons-phone-bottom').css('display', 'block');
                    
                    if( {!isHostedEnabled} ) {
                        $('#hostedSignButtonPhone').show('fast', function() {});
                        $('#hostedSignButtonPhoneBottom').show('fast', function() {});
                    }
                } else {
                    $('#agreement-header-panel').css('display', 'block');
                    $('#es-buttons-top').css('display', 'block');   
                    $('#bottom-view-action-buttons').css('display', 'block');
                    
                    if( {!isHostedEnabled} ) {
                        $('#hostedSignButton').show('fast', function() {});
                        $('#hostedSignButtonBottom').show('fast', function() {});
                    }   
                }
            }
            
            function hideAllButtons() {
                $('#agreement-header-panel').css('display', 'none');
                $('#es-buttons-top').css('display', 'none');    
                $('#bottom-view-action-buttons').css('display', 'none');                
                $('#agreement-header-panel-phone').css('display', 'none');
                $('#es-buttons-phone-top').css('display', 'none');
                $('#es-buttons-phone-bottom').css('display', 'none');
            }
            
            function showDocumentsEdit(recordId,documentIndex) {
                var agreement = agreementRecords[recordId];
                var document = agreement.documents[documentIndex];
                
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledEditDocumentsViewTempl({agreement: agreement, document: document, documentIndex: documentIndex}));
            }     

            function showObjectsSearch(recordId, recipientIndex, objectName) {
                var agreement = agreementRecords[recordId];
            
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledObjectsSearchViewTempl({agreement: agreement, recipientIndex: recipientIndex, objectName: objectName}));
            }
                         
            function showDocumentsContents(recordId, libraryId) {
                var agreement = agreementRecords[recordId];
                
                var libraryContentDocuments = new Array();
                for (var i=0;i<contentDocuments.length;i++) {
                    var library = getContentLibrary( contentDocuments[i]['ContentDocumentId'] );
                    
                    if( libraryId == 'Chatter_Files' &&
                        contentDocuments[i]['Origin'] == 'H' ) {
                        libraryContentDocuments.push( contentDocuments[i] );
                        continue;
                    }
                    
                    if( library && ( libraryId == library['Id'] ) ) {
                        libraryContentDocuments.push( contentDocuments[i] );
                    }
                }
                
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledDocumentsContentsViewTempl({agreement: agreement, libraryContentDocuments: libraryContentDocuments}));
                
                $('#documentContentLibrarySelect').append( new Option('Chatter Files', 'Chatter_Files') );
                for (var i=0;i<contentLibraries.length;i++) {
                    $('#documentContentLibrarySelect').append( new Option(contentLibraries[i]['Name'], contentLibraries[i]['Id']) );
                }
                
                $("#documentContentLibrarySelect").val(libraryId);
                
                $( "#documentContentLibrarySelect" ).change(function() {
                    showDocumentsContents(recordId, $("#documentContentLibrarySelect").val());
                });
            }
                       
            function showDocumentsLibraries(recordId, folderId) {
                var agreement = agreementRecords[recordId];
                
                var folderLibraryDocuments = new Array();
                var folders = new Array();
                for (var i=0;i<libraryDocuments.length;i++) {
                    if( !libraryDocuments[i]['Folder'] ) {
                        continue;
                    }
                    if( $.inArray(libraryDocuments[i]['Folder'], folders) == -1 ) {
                        folders.push( libraryDocuments[i]['Folder'] );  
                    }
                    var curFolderId = libraryDocuments[i]['Folder']['Id'];
                    if( curFolderId == folderId ) {
                        folderLibraryDocuments.push( libraryDocuments[i] );
                    }
                }
                
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledDocumentsLibrariesViewTempl({agreement: agreement, folderLibraryDocuments: folderLibraryDocuments}));
                
                for (var i=0;i<folders.length;i++) {
                    $('#documentLibraryFolderSelect').append( new Option(folders[i]['Name'], folders[i]['Id']) );
                }
                
                $("#documentLibraryFolderSelect").val(folderId);
                
                $( "#documentLibraryFolderSelect" ).change(function() {
                    showDocumentsLibraries(recordId, $("#documentLibraryFolderSelect").val());
                });
            } 
            
            function showDocumentsTemplates(recordId) {
                var agreement = agreementRecords[recordId];
                
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledDocumentsTemplatesViewTempl({agreement: agreement, templateDocuments: templateDocuments}));
            }            
            
            function showRecipientsEdit(recordId,recipientIndex) {
                var agreement = agreementRecords[recordId];
                var recipient;
                if( recipientIndex != -1 ) {
                    recipient = agreement.recipients[recipientIndex];
                } else { 
                    recipient = newRecipient;
                }
                
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledEditRecipientsViewTempl({agreement: agreement, recipient: recipient, recipientIndex: recipientIndex}));
                
                if( recipientIndex != -1 ) {
                    $('#recipient-edit-delete-button').show('fast', function() {});
                }
                
                for (var i=0;i<recipientRoles.length;i++) {
                    $('#recipientRoleSelect').append( new Option(recipientRoles[i], recipientRoles[i]) );
                }
                
                var recipientRole = recipient[namespace + '__Recipient_Role__c'];
                if( recipientRole != null ) {
                    $("#recipientRoleSelect").val(recipientRole);
                } else {
                    $("#recipientRoleSelect").val(defaultRecipientRole);
                }
                
                for (var i=0;i<recipientTypes.length;i++) {
                    $('#recipientTypeSelect').append( new Option(recipientTypes[i], recipientTypes[i]) );
                }
                
                var recipientType = recipient[namespace + '__Recipient_Type__c'];
                if( recipientType != null ) {
                    $("#recipientTypeSelect").val(recipientType);
                } else {
                    $("#recipientTypeSelect").val(defaultRecipientType);
                }
                
                $('#recipient-email-label').prop('disabled', true);
                
                if( recipientType == 'Contact' ) {
                    $( "#recipient-contact-section" ).show('fast', function() {});
                    $('#recipient-email-display-section').show('fast', function() {});
                } else if( recipientType == 'Lead' ) {
                    $( "#recipient-lead-section" ).show('fast', function() {});
                    $('#recipient-email-display-section').show('fast', function() {});
                } else if( recipientType == 'User' ) {
                    $( "#recipient-user-section" ).show('fast', function() {});
                    $('#recipient-email-display-section').show('fast', function() {});
                } else if( recipientType == 'Email' ) {
                    $( "#recipient-email-section" ).show('fast', function() {});
                }
                
                $( "#recipientTypeSelect" ).change(function() {
                    recipient[namespace + '__Contact__c'] = null;
                    //recipient[namespace + '__Contact__r'] = null;
                    recipient[namespace + '__Lead__c'] = null;
                    //recipient[namespace + '__Lead__r'] = null;
                    recipient[namespace + '__User__c'] = null;
                    //recipient[namespace + '__User__r'] = null;
                    recipient[namespace + '__Email_Address__c'] = null;
                    $('#recipient-email-label').val('');
                    $('#recipientEmailValue').val('');
                        
                    $( "#recipient-contact-section" ).hide('fast', function() {});
                    $( "#recipient-lead-section" ).hide('fast', function() {});
                    $( "#recipient-user-section" ).hide('fast', function() {});
                    $( "#recipient-email-section" ).hide('fast', function() {});
                    $('#recipient-email-display-section').hide('fast', function() {});

                    var recipientType = $("#recipientTypeSelect").val();
                    if( recipientType == 'Contact' ) {
                        $( "#recipient-contact-section" ).show('slow', function() {});
                        $('#recipient-email-display-section').show('slow', function() {});
                    } else if( recipientType == 'Lead' ) {
                        $( "#recipient-lead-section" ).show('slow', function() {});
                        $('#recipient-email-display-section').show('slow', function() {});
                    } else if( recipientType == 'User' ) {
                        $( "#recipient-user-section" ).show('slow', function() {});
                        $('#recipient-email-display-section').show('slow', function() {});
                    } else if( recipientType == 'Email' ) {
                        $( "#recipient-email-section" ).show('slow', function() {});
                    }
                });
                
                if( recipientType == 'Contact' && recipient[namespace + '__Contact__c'] ) { 
                    $('#recipient-contact-input').attr('placeholder', recipient[namespace + '__Contact__r']['Name']);
                    $('#recipient-contact-label').addClass('icon-utility-close');
                    $('#recipient-email-label').val( recipient[namespace + '__Contact__r']['Email'] );
                } else {
                    $('#recipient-contact-label').addClass('icon-utility-search');
                }
                
                $( "#recipient-contact-input" ).click(function() {
                    saveRecipient(agreement.agreement['Id'], recipientIndex);
                    window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/recipients/edit/' + recipientIndex + '/contacts';
                });
                
                $( "#recipient-contact-label" ).click(function() {
                    if( recipient[namespace + '__Contact__c'] ) {
                        recipient[namespace + '__Contact__c'] = null;
                        recipient[namespace + '__Contact__r'] = null;
                        $('#recipient-contact-label').removeClass('icon-utility-close');
                        $('#recipient-contact-label').addClass('icon-utility-search');
                        $('#recipient-contact-input').attr('placeholder', 'Select Contact');
                    } else {
                        saveRecipient(agreement.agreement['Id'], recipientIndex);
                        window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/recipients/edit/' + recipientIndex + '/contacts';
                    }
                });
                                
                if( recipientType == 'Lead' && recipient[namespace + '__Lead__c'] ) { 
                    $('#recipient-lead-input').attr('placeholder', recipient[namespace + '__Lead__r']['Name']);
                    $('#recipient-lead-label').addClass('icon-utility-close');
                    $('#recipient-email-label').val( recipient[namespace + '__Lead__r']['Email'] );
                } else {
                    $('#recipient-lead-label').addClass('icon-utility-search');
                }
                
                $( "#recipient-lead-input" ).click(function() {
                    saveRecipient(agreement.agreement['Id'], recipientIndex);
                    window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/recipients/edit/' + recipientIndex + '/leads';
                });
                
                $( "#recipient-lead-label" ).click(function() {
                    if( recipient[namespace + '__Lead__c'] ) {
                        recipient[namespace + '__Lead__c'] = null;
                        recipient[namespace + '__Lead__r'] = null;
                        $('#recipient-lead-label').removeClass('icon-utility-close');
                        $('#recipient-lead-label').addClass('icon-utility-search');
                        $('#recipient-lead-input').attr('placeholder', 'Select Lead');
                    } else {
                        saveRecipient(agreement.agreement['Id'], recipientIndex);
                        window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/recipients/edit/' + recipientIndex + '/leads';
                    }
                });             
                                
                if( recipientType == 'User' && recipient[namespace + '__User__c'] ) { 
                    $('#recipient-user-input').attr('placeholder', recipient[namespace + '__User__r']['Name']);
                    $('#recipient-user-label').addClass('icon-utility-close');
                    $('#recipient-email-label').val( recipient[namespace + '__User__r']['Email'] );
                } else {
                    $('#recipient-user-label').addClass('icon-utility-search');
                }
                
                $( "#recipient-user-input" ).click(function() {
                    saveRecipient(agreement.agreement['Id'], recipientIndex);
                    window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/recipients/edit/' + recipientIndex + '/users';
                });
                
                $( "#recipient-user-label" ).click(function() {
                    if( recipient[namespace + '__User__c'] ) {
                        recipient[namespace + '__User__c'] = null;
                        recipient[namespace + '__User__r'] = null;
                        $('#recipient-user-label').removeClass('icon-utility-close');
                        $('#recipient-user-label').addClass('icon-utility-search');
                        $('#recipient-user-input').attr('placeholder', 'Select User');
                    } else {
                        saveRecipient(agreement.agreement['Id'], recipientIndex);
                        window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/recipients/edit/' + recipientIndex + '/users';
                    }
                });
                
                if( isMobilePhone ) {
                    $('#recipient-contact-input-panel').css('width', '86%');
                    $('#recipient-lead-input-panel').css('width', '86%');
                    $('#recipient-luser-input-panel').css('width', '86%');
                } else {
                    $('#recipient-contact-input-panel').css('width', '96%');
                    $('#recipient-lead-input-panel').css('width', '96%');
                    $('#recipient-user-input-panel').css('width', '96%');
                }
                
            } 
            
            /*function showDocumentsView(recordId, mode) {
                var agreement = agreementRecords[recordId];
                
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledDocumentsViewTempl({agreement: agreement, mode: mode}));
            }           
            
            function showRecipientsView(recordId, mode) {
                var agreement = agreementRecords[recordId];
                
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledRecipientsViewTempl({agreement: agreement, mode: mode}));
            }*/
            
            /*function showAgreementAdd() {
                addAgreement();
            }*/
            
            function showAgreementRemove(recordId) {
                var agreement = agreementRecords[recordId];
                                
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledRemoveViewTempl({agreement: agreement}));
            }
            
            function showAgreementCancel(recordId) {
                var agreement = agreementRecords[recordId];
                                
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledCancelViewTempl({agreement: agreement}));
            }
            
            function showAgreementEdit(recordId) {
                currentAgreementState = 'edit';
                var agreement = agreementRecords[recordId];
                
                $('#mainContainer').empty();
                $('#mainContainer').append(compiledEditViewTempl({agreement: agreement}));
                
                var agreementStatus = agreement.agreement[namespace + '__Status__c'];
                if( agreementStatus == 'Draft' || agreementStatus == 'Pre-Send' || agreementStatus == 'Send in Progress' ) {
                    $('#draftStatusBar').show('slow', function() {});
                } else {
                    $('#draftStatusBar').show('slow', function() {});
                }
                
                //Init languages
                for (var i=0;i<languages.length;i++) {
                    $('#languageSelect').append( new Option(languages[i], languages[i]) );
                }
                
                var agreementLanguage = agreement.agreement[namespace + '__AgreementLocale__c'];
                if( agreementLanguage != null ) {
                    $("#languageSelect").val(agreementLanguage);
                } else {
                    $("#languageSelect").val(defaultLanguage);
                }
                
                //Init reminders
                for (var i=0;i<reminders.length;i++) {
                    if( reminders[i] == 'Never' ) {
                        $('#remindersSelect').append( new Option('', '') );
                    } else {
                        $('#remindersSelect').append( new Option(reminders[i], reminders[i]) );
                    }
                }
                
                var agreementReminder = agreement.agreement[namespace + '__RemindRecipient__c'];
                if( agreementReminder != null ) {
                    $("#remindersSelect").val(agreementReminder);
                } else {
                    $("#remindersSelect").val(defaultReminder);
                }
                
                //Init sender signature
                $('#senderSignatureSelect').append( new Option('', '') );
                for (var i=0;i<signatureOrders.length;i++) {
                    $('#senderSignatureSelect').append( new Option(signatureOrders[i], signatureOrders[i]) );
                }
                
                var agreementSignatureOrder = agreement.agreement[namespace + '__SignatureOrder__c'];
                var agreementSenderSigns = agreement.agreement[namespace + '__SenderSigns__c'];
                if( agreementSignatureOrder != null && agreementSenderSigns ) {
                    $("#senderSignatureSelect").val(agreementSignatureOrder);
                } else {
                    $("#senderSignatureSelect").val('');
                }
                
                $('#hostedCheckbox').attr("checked", agreement.agreement[namespace + '__Enable_Hosted_Signing__c']);
                
                if( agreement['signingDeadlineYear'] != null &&
                    agreement['signingDeadlineMonth'] != null &&
                    agreement['signingDeadlineDay'] != null ) {             
                    var expirationDate = new Date( agreement['signingDeadlineYear'], agreement['signingDeadlineMonth'], agreement['signingDeadlineDay'] + 1, 0, 0, 0, 0 );
                    var dateString = expirationDate.toISOString().substring(0, expirationDate.toISOString().indexOf('T'));
                    $('#agreementExpirationInput').val(dateString);
                }
                
                setRecipientsList(agreement, 'edit');             
                setDocumentsList(agreement, 'edit');
                
                if( agreement.agreement[namespace + '__Account__c'] ) { 
                    $('#agreement-account-input').attr('placeholder', agreement.agreement[namespace + '__Account__r']['Name']);
                    $('#agreement-account-label').addClass('icon-utility-close');
                } else {
                    $('#agreement-account-label').addClass('icon-utility-search');
                }
                
                $( "#agreement-account-input" ).click(function() {
                    pullAgreementWrapper( agreement.agreement['Id'] );
                    window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/accounts';
                });
                
                $( "#agreement-account-label" ).click(function() {
                    if( agreement.agreement[namespace + '__Account__c'] ) {
                        agreement.agreement[namespace + '__Account__c'] = null;
                        agreement.agreement[namespace + '__Account__r'] = null;
                        $('#agreement-account-label').removeClass('icon-utility-close');
                        $('#agreement-account-label').addClass('icon-utility-search');
                        $('#agreement-account-input').attr('placeholder', 'Select Account');
                    } else {
                        pullAgreementWrapper( agreement.agreement['Id'] );
                        window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/accounts';
                    }
                });
                
                if( agreement.agreement[namespace + '__Opportunity__c'] ) { 
                    $('#agreement-opp-input').attr('placeholder', agreement.agreement[namespace + '__Opportunity__r']['Name']);
                    $('#agreement-opp-label').addClass('icon-utility-close');
                } else {
                    $('#agreement-opp-label').addClass('icon-utility-search');
                }
                
                $( "#agreement-opp-input" ).click(function() {
                    pullAgreementWrapper( agreement.agreement['Id'] );
                    window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/opps';
                });
                
                $( "#agreement-opp-label" ).click(function() {
                    if( agreement.agreement[namespace + '__Opportunity__c'] ) {
                        agreement.agreement[namespace + '__Opportunity__c'] = null;
                        agreement.agreement[namespace + '__Opportunity__r'] = null;
                        $('#agreement-opp-label').removeClass('icon-utility-close');
                        $('#agreement-opp-label').addClass('icon-utility-search');
                        $('#agreement-opp-input').attr('placeholder', 'Select Opportunity');
                    } else {
                        pullAgreementWrapper( agreement.agreement['Id'] );
                        window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/opps';
                    }
                });
                
                if( agreement.agreement[namespace + '__Contract__c'] ) { 
                    $('#agreement-contract-input').attr('placeholder', agreement.agreement[namespace + '__Contract__r']['ContractNumber']);
                    $('#agreement-contract-label').addClass('icon-utility-close');
                } else {
                    $('#agreement-contract-label').addClass('icon-utility-search');
                }
                
                $( "#agreement-contract-input" ).click(function() {
                    pullAgreementWrapper( agreement.agreement['Id'] );
                    window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/contracts';
                });
                
                $( "#agreement-contract-label" ).click(function() {
                    if( agreement.agreement[namespace + '__Contract__c'] ) {
                        agreement.agreement[namespace + '__Contract__c'] = null;
                        agreement.agreement[namespace + '__Contract__r'] = null;
                        $('#agreement-contract-label').removeClass('icon-utility-close');
                        $('#agreement-contract-label').addClass('icon-utility-search');
                        $('#agreement-contract-input').attr('placeholder', 'Select Contract');
                    } else {
                        pullAgreementWrapper( agreement.agreement['Id'] );
                        window.location.href = '#/agreement/edit/' + agreement.agreement['Id'] + '/contracts';
                    }
                });
                
                showEditButtons();
                
                $( "#agreementNameValue" ).change(function() {
                    $('#agreement-name-header').text( $('#agreementNameValue').val() );
                });
            }
            
            /*function setDocumentsLabel(agreement) {
                var documentsSummaryLabel = new String();
                for (var i=0;i<agreement.documents.length;i++) {
                    var document = agreement.documents[i];
                    var documentName = document['name'];

                    documentsSummaryLabel += documentName + ', ';
                }
                
                documentsSummaryLabel = documentsSummaryLabel == '' ? documentsSummaryLabel : documentsSummaryLabel.slice(0,documentsSummaryLabel.length-2).trim();
                
                $('#documentsSummaryLabel').text( documentsSummaryLabel );
            }*/
            
            function setEventsList(agreement) {
                $('ul#events-view-list li:not(:first)').remove();
                
                var agreementId = agreement.agreement['Id'];
                
                for (var i=0;i<agreement.events.length;i++) {
                    var event = agreement.events[i];
                    var eventDescription = event[namespace + '__Description__c'];
                    var eventDate = new Date( event[namespace + '__Date__c'] );
                    var eventDateStr = eventDate.toLocaleDateString() + ' ' + eventDate.toLocaleTimeString();
                    
                    eventDescription = $.encoder.encodeForHTML(eventDescription);
                    
                    $('#events-view-list').append('<li class="pam border-bottom border--8"><div class="mbs flag flag--rev"><div class="flag--body"><div><span class="f3 text-color-1 fw-semibold">' + eventDateStr + '</span></div><div style="padding-top: 5px;"><span class="f3 text-color-1 fw-semibold">' + eventDescription + '</span></div></div></div></li>');          
                }
            }            
            
            function setDocumentsList(agreement, stateType) {
                $('ul#documents-' + stateType + '-list li:not(:first)').remove();
                
                var agreementId = agreement.agreement['Id'];
                
                for (var i=0;i<agreement.documents.length;i++) {
                    var document = agreement.documents[i];
                    var documentName = document['name'];
                    var documentIndex = i;
                    var iconType;
                    
                    if( document.isDocument && document.isFormFieldLayer ) {
                        iconType = 'icon--layer';
                    } else if( document.isDocument ) {
                        iconType = 'icon--template';
                    } else if( document.documentType == 'pdf' ) {
                        iconType = 'icon--pdf';
                    } else if( document.documentType == 'doc' || document.documentType == 'docx' ) {
                        iconType = 'icon--word';
                    } else if( document.documentType == 'ppt' || document.documentType == 'pptx' ) {
                        iconType = 'icon--ppt';
                    } else if( document.documentType == 'xls' || document.documentType == 'xlsx' ) {
                        iconType = 'icon--excel';
                    } else if( document.documentType == 'jpeg' || document.documentType == 'jpg' || document.documentType == 'png' || document.documentType == 'gif' ) {
                        iconType = 'icon--image';
                    }
                    
                    var editPrefix = '';
                    var editPostfix = '';
                    var editDeleteElement = '';
                    if( stateType == 'edit' ) {
                        editPrefix = '<a href="#/agreement/edit/' + agreementId + '/documents/edit/' + documentIndex + '">';
                        editPostfix = '</a>';
                        editDeleteElement = '<div style="padding-bottom: 5px;"><a href="javascript:deleteDocument(\'' + agreementId + '\', ' + documentIndex + ');" title="Delete" class="fr">Delete</a></div>';
                    }
 
                    $('#documents-' + stateType + '-list').append(editPrefix + '<li class="pam border-bottom border--8"><div class="mbs flag flag--rev"><div class="flag--body"><span class="f3 text-color-1 fw-semibold">' + documentName + '</span></div><div class="flag--image prm"><div class="icon ' + iconType + ' bgs-100 a-mid sq-30"></div></div></div>' + editDeleteElement + '</li>' + editPostfix);          
                }
            }
            
            function setRecipientsList(agreement, stateType) {
                $('ul#recipients-' + stateType + '-list li:not(:first)').remove();
                
                var agreementId = agreement.agreement['Id'];
                
                for (var i=0;i<agreement.recipients.length;i++) {
                    var recipient = agreement.recipients[i];
                    var recipientIndex = i;
                    var type = recipient[namespace + '__Recipient_Type__c'];
                    
                    var recipientName = '';
                    var recipientEmail = '';
                    var recipientId = '';
                    var iconType;
                    if( type == 'Contact' ) {
                        if( recipient[namespace + '__Contact__r'] ) {
                            recipientName = recipient[namespace + '__Contact__r']['Name'];
                            recipientEmail = recipient[namespace + '__Contact__r']['Email'];
                            recipientId = recipient[namespace + '__Contact__c']
                        }
                        iconType = 'icon--contact';
                    } else if( type == 'Lead' ) {
                        if( recipient[namespace + '__Lead__r'] ) {
                            recipientName = recipient[namespace + '__Lead__r']['Name'];
                            recipientEmail = recipient[namespace + '__Lead__r']['Email'];
                            recipientId = recipient[namespace + '__Lead__c']
                        }
                        iconType = 'icon--lead';
                    } else if( type == 'User' ) {
                        if( recipient[namespace + '__User__r'] ) {
                            recipientName = recipient[namespace + '__User__r']['Name'];
                            recipientEmail = recipient[namespace + '__User__r']['Email'];
                            recipientId = recipient[namespace + '__User__c']
                        }
                        iconType = 'icon--people';
                    } else if( type == 'Email' ) {
                        recipientName = recipient[namespace + '__Email_Address__c'];
                        recipientEmail = '';
                        iconType = 'icon--email';
                    }
                    
                    var editPrefix = '';
                    var editPostfix = '';
                    var editDeleteElement = '';
                    if( stateType == 'edit' ) {
                        editPrefix = '<a href="#/agreement/edit/' + agreementId + '/recipients/edit/' + recipientIndex + '">';
                        editPostfix = '</a>';
                        editDeleteElement = '<div style="padding-bottom: 5px;"><a href="javascript:deleteRecipient(\'' + agreementId + '\', ' + recipientIndex + ');" title="Delete" class="fr">Delete</a></div>';
                    } else if( stateType == 'view' && recipientId ) {
                        editPrefix = '<a href="javascript:sforce.one.navigateToSObject(\'' + recipientId + '\')">';
                        editPostfix = '</a>';
                    }
                    
                    $('#recipients-' + stateType + '-list').append(editPrefix + '<li class="pam border-bottom border--8"><div class="mbs flag flag--rev"><div class="flag--body"><span class="f3 text-color-1 fw-semibold">' + recipientName + '</span></div><div class="flag--image prm"><div class="icon ' + iconType + ' bgs-100 a-mid sq-30"></div></div></div><ul class="list-plain man pan"><li class="f5 text-color-2">' + recipientEmail + '</li></ul>' + editDeleteElement + '</li>' + editPostfix);
                }   
                    
            }
            
            /*function setRecipientsLabel(agreement) {
                var recipientsSummaryLabel = new String();
                for (var i=0;i<agreement.recipients.length;i++) {
                    var recipient = agreement.recipients[i];
                    var type = recipient[namespace + '__Recipient_Type__c'];
                    
                    var recipientName;
                    if( type == 'Contact' &&
                        recipient[namespace + '__Contact__r'] ) {
                        recipientName = recipient[namespace + '__Contact__r']['Name'];  
                    } else if( type == 'Lead' &&
                        recipient[namespace + '__Lead__r'] ) {
                        recipientName = recipient[namespace + '__Lead__r']['Name'];
                    } else if( type == 'User' &&
                        recipient[namespace + '__User__r'] ) {
                        recipientName = recipient[namespace + '__User__r']['Name'];
                    } else if( type == 'Email' ) {
                        recipientName = recipient[namespace + '__Email_Address__c'];
                    } else {
                        recipientName = '';
                    }
                    
                    recipientsSummaryLabel += recipientName + ', ';
                }
                
                recipientsSummaryLabel = recipientsSummaryLabel == '' ? recipientsSummaryLabel : recipientsSummaryLabel.slice(0,recipientsSummaryLabel.length-2).trim();
                
                $('#recipientsSummaryLabel').text( recipientsSummaryLabel );
            }*/
            
            function normalizeParameter(param) {
                var i = param.indexOf('?');
                if( i != -1 ) {
                    param = param.substring(0,i);
                }
                return param;
             }
                             
        function affirmSigner(agreementId) {
            var agreementWrapper = agreementRecords[ agreementId ];
            
            hideAffirmPassDialog();
            closeSendConfirmation(agreementId);
            sforce.one.navigateToURL(currentSigningUrl);
        }
        
        function showChooseSignersDialog(signingUrls) {
            $('#overlay-signers').show('fast', function() {});
            $('#choose-signers-dialog').show('fast', function() {});
            
            $('div#choose-signers-buttons-dialog button').remove();
            
            signingUrlRecords = new Array();
            
            for(var i=0;i<signingUrls.length;i++) {
                var signerEmail = signingUrls[i]['email'];
                signingUrlRecords[signerEmail] = signingUrls[i];
                $('#choose-signers-buttons-dialog').append('<button style="margin-top: 20px;" autofocus="autofocus" onclick="chooseSigner(\'' + signerEmail + '\');" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm"><span class="text-color-4 f3 fw-semibold">' + signerEmail + '</span></button>');
            }
            
            $('#choose-signers-buttons-dialog').append('<button style="margin-top: 20px;" autofocus="autofocus" onclick="hideChooseSignersDialog();" class="btn bg-secondary-btn btn--secondary pvs size-full brm border border--2 mbm"><span class="text-color-4 f3 fw-semibold">Cancel</span></button>');
        }
        
        function chooseSigner(signerEmail) {
            currentSigningEmail = signerEmail;
            currentSigningUrl = signingUrlRecords[signerEmail]['esignUrl'];
            
            $('#choose-signers-dialog').hide('fast', function() {});
            $('#overlay-signers').hide();
            
            showConfirmPassDialog();
        }
        
        function hideChooseSignersDialog() {
            $('#choose-signers-dialog').hide('fast', function() {});
            $('#overlay-signers').hide();
            //$('#pass-confirm-ok-button').attr('autofocus','autofocus')        
                        
            $('#progressSpinner').hide('fast', function() {});
            if( isMobilePhone ) {
                $('#es-buttons-phone-bottom').show('fast', function() {});
            } else {
                $('#bottom-view-action-buttons').show('fast', function() {});
            }
            $('#viewAgreementContent').show('fast', function() {});
        }
        
        function showAffirmPassDialog() {
            hideConfirmPassDialog();
            
            $('#overlay-affirm').show('fast', function() {});
            $('#affirm-signer-dialog').show('fast', function() {});
            
            if( isMobilePhone ) {
                $('#affirm-signer-dialog-content').css('position', 'absolute');
                $('#affirm-signer-dialog-content').css('left', '5%');
                $('#affirm-signer-dialog-content').css('width', '300px');
                
                $('#affirm-descr-span').css('width', '300px');
                $('#affirm-yes-span').css('width', '300px');
                $('#affirm-no-span').css('width', '300px');
            }
            
            $('#affirm-descr-span').text( 'By proceeding, you affirm that you are ' + currentSigningEmail+ ' and are authorized to sign this agreement.' );
            $('#affirm-yes-span').text( 'I am ' + currentSigningEmail );
            $('#affirm-no-span').text( 'I am NOT ' + currentSigningEmail );
        }
        
        function hideAffirmPassDialog() {
            $('#affirm-signer-dialog').hide('fast', function() {});
            $('#overlay-affirm').hide();
            $('#pass-affirm-ok-button').attr('autofocus','autofocus');
            
            $('#progressSpinner').hide('fast', function() {});
            if( isMobilePhone ) {
                $('#es-buttons-phone-bottom').show('fast', function() {});
            } else {
                $('#bottom-view-action-buttons').show('fast', function() {});
            }
            $('#viewAgreementContent').show('fast', function() {});
        }               
               
        function showConfirmPassDialog() {
            $('#overlay-pass').show('fast', function() {});
            $('#pass-device-dialog').show('fast', function() {});
            
            if( isMobilePhone ) {
                $('#pass-device-dialog-content').css('position', 'absolute');
                $('#pass-device-dialog-content').css('left', '5%');
                $('#pass-device-dialog-content').css('width', '310px');
            }
        }
        
        function hideConfirmPassDialog() {
            $('#pass-device-dialog').hide('fast', function() {});
            $('#overlay-pass').hide();
            $('#pass-confirm-ok-button').attr('autofocus','autofocus');
            
            $('#progressSpinner').hide('fast', function() {});
            if( isMobilePhone ) {
                $('#es-buttons-phone-bottom').show('fast', function() {});
            } else {
                $('#bottom-view-action-buttons').show('fast', function() {});
            }
            $('#viewAgreementContent').show('fast', function() {});
        }
                     
        function showAddDocumentActionsDialog() {
            $('#overlay').show();
            $('#document-add-actions-dialog').show('fast', function() {});
        }
        
        function hideAddDocumentActionsDialog() {
            $('#document-add-actions-dialog').hide('fast', function() {});
            $('#overlay').hide();
            $('#library-document-add-button').attr('autofocus','autofocus')
        }
        
        /*window.addEventListener("orientationchange", function() {
            alert(window.orientation);
            if( currentAgreementState == 'edit' ) {
                showEditButtons();
            } else if( currentAgreementState == 'view' ) {
                showViewButtons();
            }
        }, false);
        
        $( window ).resize(function() {
            alert('resized!');
        });
        */  
                
                        /*Path.map("#/agreements").to(function(){
                            getAllAgreements();
                        });*/
    
                        Path.map("#/agreement/:agreementId").to(function(){
                            showAgreementDetails(this.params['agreementId']);
                        });
    
                        Path.map("#/agreement/:agreementId/recipients").to(function(){
                            showRecipientsView(this.params['agreementId'], 'view');
                        }); 
                        
                        /*Path.map("#/agreement/:agreementId/documents").to(function(){
                            showDocumentsView(this.params['agreementId'], 'view');
                        });*/         
                        
                        Path.map("#/agreement/edit/:agreementId").to(function(){
                            showAgreementEdit(this.params['agreementId']);
                        });
                                                                        
                        Path.map("#/agreement/remove/:agreementId").to(function(){
                            showAgreementRemove(this.params['agreementId']);
                        });  
                        
                        Path.map("#/agreement/cancel/:agreementId").to(function(){
                            showAgreementCancel(this.params['agreementId']);
                        });  
                        
                        /*Path.map("#/agreement/edit/:agreementId/recipients").to(function(){
                            showRecipientsView(this.params['agreementId'], 'edit');
                        });*/
                        
                        Path.map("#/agreement/edit/:agreementId/recipients/edit/:recipientIndex").to(function(){
                            showRecipientsEdit(this.params['agreementId'],this.params['recipientIndex']);
                        });
                        
                        /*Path.map("#/agreement/edit/:agreementId/documents").to(function(){
                            showDocumentsView(this.params['agreementId'], 'edit');
                        });*/
                        
                        Path.map("#/agreement/edit/:agreementId/documents/edit/:documentIndex").to(function(){
                            showDocumentsEdit(this.params['agreementId'],this.params['documentIndex']);
                        }); 
                        
                        Path.map("#/agreement/edit/:agreementId/documents/templates").to(function(){
                            showDocumentsTemplates(this.params['agreementId']);
                        });
                        
                        Path.map("#/agreement/edit/:agreementId/documents/libraries/:folderId").to(function(){
                            showDocumentsLibraries(this.params['agreementId'],this.params['folderId']);
                        });
                        
                        Path.map("#/agreement/edit/:agreementId/documents/contents/:libraryId").to(function(){
                            showDocumentsContents(this.params['agreementId'],this.params['libraryId']);
                        }); 
                        
                        Path.map("#/agreement/edit/:agreementId/accounts").to(function(){
                            showObjectsSearch(this.params['agreementId'],this.params['recipientIndex'],'Account');
                        }); 
                        
                        Path.map("#/agreement/edit/:agreementId/opps").to(function(){
                            showObjectsSearch(this.params['agreementId'],this.params['recipientIndex'],'Opportunity');
                        });
                                                
                        Path.map("#/agreement/edit/:agreementId/contracts").to(function(){                         
                            showObjectsSearch(this.params['agreementId'],this.params['recipientIndex'],'Contract');
                        });            
                                                
                        Path.map("#/agreement/edit/:agreementId/recipients/edit/:recipientIndex/contacts").to(function(){
                            showObjectsSearch(this.params['agreementId'],this.params['recipientIndex'],'Contact');
                        }); 
                                                
                        Path.map("#/agreement/edit/:agreementId/recipients/edit/:recipientIndex/leads").to(function(){
                            showObjectsSearch(this.params['agreementId'],this.params['recipientIndex'],'Lead');
                        });              
                                                                        
                        Path.map("#/agreement/edit/:agreementId/recipients/edit/:recipientIndex/users").to(function(){
                            showObjectsSearch(this.params['agreementId'],this.params['recipientIndex'],'User');
                        }); 
                                                                        
                        /*Path.map("#/agreement").to(function(){
                            showAgreementAdd();
                        });*/ 
                        
                        Path.listen();    
    </script>
    
    
</head>

<body>
    
    <div id="mainContainer">
    </div>

</body>

</apex:page>