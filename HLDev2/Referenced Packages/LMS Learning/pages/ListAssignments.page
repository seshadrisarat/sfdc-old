<apex:page controller="lmscons.AssignmentExtension" showheader="{!ShowHeader}" title="Assignments" sidebar="false" tabStyle="lmscons__Transcript_Line__c">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>{!$Label.User_Assignments}</title>
<apex:includeScript value="{!URLFOR($Resource.lmscons__LMSSource, 'js/jquery.js')}"/>
<!--<apex:includeScript value="{!URLFOR($Resource.LMSSource, 'js/init.js')}"/>
<apex:stylesheet value="{!URLFOR($Resource.LMSSource, 'css/training.css')}"/>
<apex:stylesheet value="{!URLFOR($Resource.MyTeam, 'css/team.css')}"/>-->
<apex:stylesheet value="{!URLFOR($Resource.lmscons__lmslightbox, 'css/lms-lightbox.css')}"/>
<apex:stylesheet value="{!URLFOR($Resource.lmscons__jquery1816min, 'jquery-ui.css')}" />
<apex:stylesheet value="{!URLFOR($Resource.lmscons__LMSSearch, 'css/search-catalog.css')}"/>
<apex:includeScript value="{!URLFOR($Resource.lmscons__jquery1816min, 'jquery-ui.min.js')}" />

<style>
	.centerAlign {
		text-align: center;
	}
</style>

<script type="text/javascript">
	jQuery.noConflict();
</script>

<script type="text/javascript">

	jQuery(document).ready(function(){
		jQuery('.m-tbl td:empty').html('&nbsp;');
		HideShowRowsToggler();
		SetColspan();
		SafariFix();
	});

	function SafariFix(){
		/* safari fix */
		if (navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1) {
			jQuery('body').addClass('m-safari');
		}

		/* mac fix */
		if((navigator.platform.indexOf("Mac") != -1)) {
			jQuery('body').addClass('m-mac').removeClass('m-safari');
		}
	}

	function SetColspan() {
		jQuery('.b-assignments .m-tbl').each(function(i) {
			var CountTd = jQuery(this).find('th').size();
			jQuery('.b-assignments').eq(i).find('.b-inner').attr('colspan', CountTd);
		});
	}

	/* Hide/Show toggler */
	function HideShowRowsToggler() {
		jQuery('.m-hide').hide();

		jQuery('.b-title.m-plus').click(function () {
			jQuery(this).toggleClass('m-minus');
			jQuery(this).next('.m-hide').toggle();
			jQuery(this).parent().parent('tr').next('tr').toggle();
		});
	}

	function open_popup(cid, trid, type, act) {
		var line = 'content_id='+cid+'-'+trid+'-'+type+'-'+act;

		jQuery('#dialog-modal').html('<iframe frameborder="0" height="600px" id="mytr_popup_frame" name="mytr_popup_frame" src="{!$Page.ListAssignments}?'+line+'" width="100%"></iframe>');

		jQuery('#dialog-modal').dialog({
			autoOpen: false,
			width: jQuery(window).width()*0.9,
			height: jQuery(window).height()*0.9,
			modal: true,
			resizable: false,
			close: function(event, ui) { refresh_page() }
		});

		jQuery("#dialog-modal").dialog('open');
	}

	function close_popup() {
		jQuery("#dialog-modal").dialog('close');
	}

	function ask_confirmation() {
		return confirm("{!JSENCODE($Label.Assignment_Page_Delete_Assignment)}");
	}

	function runScript(e) {
		if (e.keyCode == 13) {
			refresh_page();
			//return false;
		}
	}
</script>
<style type="text/css">
	allign_left {float:left;}
	.bPageBlock .detailList .labelCol {width:auto; text-align:left; white-space:nowrap;}
	.bPageBlock .detailList .dataCol {width:auto; padding-right:30px;}
	.apexp .bPageBlock .detailList {width:auto;}
</style>
</head>
<body>
<apex:form id="wholeform">

<script type="javascript">
	function CheckWindowForClose() {
		if ({!ClosePopup} == true) {
			parent.close_popup();
		}
	}
</script>

<apex:pageMessages id="messages" />
<apex:pageBlock title="{!$Label.Assignment_Edit}" rendered="{!PageNum = 3}">

	<apex:pageBlockSection title="Edit Curriculum Assignment" columns="1" rendered="{!ContType = OT_CURRICULUM}">
		<apex:inputField value="{!Curriculum_Assignment.lmscons__Last_Launched_Date__c}"/>
		<apex:inputField value="{!Curriculum_Assignment.lmscons__Completion_Date__c}"/>
		<apex:inputField value="{!Curriculum_Assignment.lmscons__Due_Date__c}"/>
		<apex:outputText label="Training Type:" value="Curriculum" />
		<apex:inputField value="{!Curriculum_Assignment.lmscons__Curriculum_Progress__c}"/>
		<apex:inputField value="{!Curriculum_Assignment.lmscons__Status__c}"/>
	</apex:pageBlockSection>

	<apex:pageBlockSection title="{!$Label.Edit_Learning_Path_Assignment}" columns="1" rendered="{!ContType = OT_LEARNING_PATH}">
		<apex:inputField value="{!Learning_Path_Assignment.lmscons__Last_Launched_Date__c}"/>
		<apex:inputField value="{!Learning_Path_Assignment.lmscons__Completion_Date__c}"/>
		<apex:inputField value="{!Learning_Path_Assignment.lmscons__Due_Date__c}"/>
		<apex:outputText label="Training Type:" value="Learning Path" />
		<apex:inputField value="{!Learning_Path_Assignment.lmscons__Learning_Path_Progress__c}"/>
		<apex:inputField value="{!Learning_Path_Assignment.lmscons__Status__c}"/>
	</apex:pageBlockSection>

	<apex:pageBlockSection title="{!$Label.Edit_Course_Assignment}" columns="1" rendered="{!ContType = OT_COURSE}">
		<apex:inputField value="{!Course_Assignment.lmscons__Last_Launched_Date__c}"/>
		<apex:inputField value="{!Course_Assignment.lmscons__Completion_Date__c}"/>
		<apex:inputField value="{!Course_Assignment.lmscons__Due_Date__c}"/>
		<apex:outputText label="Training Type:" value="Course" />
		<apex:outputLabel />
		<apex:inputField value="{!Course_Assignment.lmscons__Progress_Training_Path__c}"/>
		<apex:inputField value="{!Course_Assignment.lmscons__StatusPicklist__c}"/>
	</apex:pageBlockSection>

	<apex:pageBlockSection title="{!$Label.Information}" columns="2" rendered="{!CONTAINS(OT_LOW_LEVEL_SET, ContType)}">
		<apex:inputField value="{!Module_Assignment.Name}"/>
		<apex:inputField value="{!Module_Assignment.lmscons__Trainee__c}"/>
		<apex:inputField value="{!Module_Assignment.lmscons__Due_Date__c}"/>
		<apex:inputField value="{!Module_Assignment.lmscons__Transcript__c}"/>
		<apex:outputText label="Training Type:" value="{!ContType}" />
		<apex:inputField value="{!Module_Assignment.lmscons__Content_Title__c}"/>
		<apex:outputLabel />
		<apex:outputField value="{!Module_Assignment.lmscons__Training_Content__c}"/>
		<apex:outputText label="{!$Label.Parent_Object}" value="{!ParentObject}" />
	</apex:pageBlockSection>

	<apex:pageBlockSection title="{!$Label.Progress_Information}" columns="2" rendered="{!CONTAINS(OT_LOW_LEVEL_SET, ContType)}">
		<apex:inputField value="{!Module_Assignment.lmscons__Status__c}"/>
		<apex:inputField value="{!Module_Assignment.lmscons__Last_Launched_Date__c}"/>
		<apex:inputField value="{!Module_Assignment.lmscons__Percent_Complete__c}"/>
		<apex:inputField value="{!Module_Assignment.lmscons__Completed_Date__c}"/>
		<apex:inputField value="{!Module_Assignment.lmscons__Score__c}"/>
		<apex:inputField value="{!Module_Assignment.lmscons__Attempts__c}"/>
	</apex:pageBlockSection>

	<apex:pageBlockButtons location="bottom">
		<apex:commandButton action="{!SaveAssignment}" value="{!$Label.Save}" status="save_assignment" rerender="wholeform"/>
		<apex:commandButton action="{!CancelSaveAssignment}" value="{!$Label.Cancel}" status="save_assignment" rerender="wholeform"/>

		<apex:actionStatus id="save_assignment" onstop="CheckWindowForClose();">
			<apex:facet name="start">
				<apex:image url="/img/loading.gif" />
			</apex:facet>
		</apex:actionStatus>

	</apex:pageBlockButtons>
</apex:pageBlock>

<apex:pageBlock title="{!UserName}" rendered="{!PageNum = 2}">
	<apex:outputpanel id="b1" layout="none">
		<div class="b-assignments">
			<table width="100%" cellpadding="0" cellspacing="0" class="m-tbl">
				<thead>
					<tr>
						<th class="m-td-title">{!$Label.SearchCatalog_Column_Title}</th>
						<th class="m-td-descr">{!$Label.SearchCatalog_Column_Description}</th>
						<th class="m-td-type">{!$Label.SearchCatalog_Column_Type}</th>

						<!-- X -->
						<th class="m-td-assigned">{!$Label.Assignments_Assigned}</th>
						<th class="m-td-status">{!$Label.Assignments_Status}</th>
						<th class="m-td-progress">{!$Label.Assignments_Progress}</th>
						<th class="m-td-score">{!$Label.Assignments_Score}</th>
						<th class="m-td-attempts">{!$Label.Attempts}</th>
						<th class="m-td-completed">{!$Label.Assignments_Completed}</th>
						<!-- X -->

						<th class="m-td-items">{!$Label.SearchCatalog_Column_Items}</th>
						<th class="m-td-btns">&nbsp;</th>
					</tr>
				</thead>
				<tbody>
					<apex:repeat value="{!SearchItem}" var="s" id="rep">
					<!-------------------------- MODULES ---------------------------------->
						<apex:outputpanel rendered="{!CONTAINS(OT_LOW_LEVEL_SET, s.StaticType)}" layout="none">
							<tr>
								<td class="m-td-title"><div class="b-title">{!s.Module.Title}</div></td>
								<td class="m-td-descr">{!s.Module.Description}</td>
								<td class="m-td-type">{!s.Type}</td>

								<!-- X -->
								<td class="m-td-assigned">
									<apex:outputText value="{0,date,MM/dd/yyyy}">
										<apex:param value="{!s.Module.AssignDate}" />
									</apex:outputText>
								</td>
								<td class="m-td-status">{!s.Module.Status}</td>
								<td class="m-td-progress">{!s.Module.Progress}</td>
								<td class="m-td-score">{!s.Module.Score}</td>
								<td class="m-td-completed">
									<apex:outputText value="{0,date,MM/dd/yyyy}">
										<apex:param value="{!s.Module.Completed}" />
									</apex:outputText>
								</td>
								<!-- X -->

								<td class="m-td-items">1</td>
								<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!s.Module.ItemId}-{!TrId}-{!s.StaticType}-edit_module&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
							</tr>
						</apex:outputpanel>
						<!-------------------------- COURSES ---------------------------------->
						<apex:outputpanel rendered="{!s.StaticType = OT_COURSE}" layout="none" id="m2">
							<tr>
								<td class="m-td-title"><div class="b-title m-plus">{!s.Module.Title}</div></td>
								<td class="m-td-descr">{!s.Module.Description}</td>
								<td class="m-td-type">{!s.Type}</td>

								<!-- X -->
								<td class="m-td-assigned">
									<apex:outputText value="{0,date,MM/dd/yyyy}">
										<apex:param value="{!AssignDate}" />
									</apex:outputText>
								</td>
								<td class="m-td-status">{!Status}</td>
								<td class="m-td-progress">{!Progress}</td>
								<td class="m-td-score">{!Score}</td>
								<td class="m-td-attempts"></td> <!-- for saving layout  -->
								<td class="m-td-completed">
									<apex:outputText value="{0,date,MM/dd/yyyy}">
										<apex:param value="{!Completed}" />
									</apex:outputText>
								</td>
								<!-- X -->

								<td class="m-td-items">{!Items}</td>
								<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!s.Module.ItemId}-{!TrId}-{!s.StaticType}-edit&retURL={!URLENCODE($CurrentPage.URL)}" class="b-btn">{!$Label.Edit}</a></td>
							</tr>
							<tr class="m-hide">
								<td class="b-inner m-level-1" colspan="5">
									<table width="100%" cellspacing="0" cellpadding="0">
										<tbody>
											<apex:repeat value="{!s.Modules}" var="m">
												<tr>
													<td class="m-td-title"><div class="b-title">{!m.Title}</div></td>
													<td class="m-td-descr">{!m.Description}</td>
													<td class="m-td-type">{!m.Type}</td>

													<!-- X -->
													<td class="m-td-assigned">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.AssignDate}" />
														</apex:outputText>
													</td>
													<td class="m-td-status">{!m.Status}</td>
													<td class="m-td-progress">{!m.Progress}</td>
													<td class="m-td-score">{!m.Score}</td>
													<td class="m-td-attempts">{!m.Attempts}</td>
													<td class="m-td-completed">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.Completed}" />
														</apex:outputText>
													</td>
													<!-- X -->

													<td class="m-td-items">1</td>
													<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!m.ItemId}-{!TrId}-{!m.StaticType}-edit_module-null-null-{!s.Module.ItemId}&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
												</tr>
											</apex:repeat>
										</tbody>
									</table>
								</td>
							</tr>
						</apex:outputpanel>
						<!-------------------------- LEARNING PATHS ---------------------------------->
						<apex:outputpanel rendered="{!s.StaticType  = OT_LEARNING_PATH}" layout="none" id="m3">
							<tr>
								<td class="m-td-title"><div class="b-title m-plus">{!s.Module.Title}</div></td>
								<td class="m-td-descr">{!s.Module.Description}</td>
								<td class="m-td-type">{!s.Type}</td>

								<!-- X -->
								<td class="m-td-assigned">
									<apex:outputText value="{0,date,MM/dd/yyyy}">
										<apex:param value="{!AssignDate}" />
									</apex:outputText>
								</td>
								<td class="m-td-status">{!Status}</td>
								<td class="m-td-progress">{!Progress}</td>
								<td class="m-td-score">{!Score}</td>
								<td class="m-td-attempts"></td> <!-- for saving layout  -->
								<td class="m-td-completed">
									<apex:outputText value="{0,date,MM/dd/yyyy}">
										<apex:param value="{!Completed}" />
									</apex:outputText>
								</td>
								<!-- X -->

								<td class="m-td-items">{!Items}</td>
								<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!s.Module.ItemId}-{!TrId}-{!s.StaticType}-edit&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
							</tr>
							<tr class="m-hide">
								<td class="b-inner m-level-1" colspan="5">
									<table width="100%" cellspacing="0" cellpadding="0">
										<tbody>
											<apex:repeat value="{!s.Courses}" var="m">
												<tr>
													<td class="m-td-title"><div class="b-title m-plus">{!m.Course.Title}</div></td>
													<td class="m-td-descr">{!m.Course.Description}</td>
													<td class="m-td-type">{!m.Course.Type}</td>

													<!-- X -->
													<td class="m-td-assigned">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.Course.AssignDate}" />
														</apex:outputText>
													</td>
													<td class="m-td-status">{!m.Course.Status}</td>
													<td class="m-td-progress">{!m.Course.Progress}</td>
													<td class="m-td-score">{!m.Course.Score}</td>
													<td class="m-td-attempts"></td> <!-- for saving layout  -->
													<td class="m-td-completed">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.Course.Completed}" />
														</apex:outputText>
													</td>
													<!-- X -->

													<td class="m-td-items">{!m.Modules.size}</td>
													<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!m.Course.ItemId}-{!TrId}-{!m.Course.StaticType}-edit&retURL={!URLENCODE($CurrentPage.URL)}" class="b-btn">{!$Label.Edit}</a></td>
												</tr>
												<tr class="m-hide">
													<td class="b-inner m-level-2" colspan="5">
														<table width="100%" cellspacing="0" cellpadding="0">
															<tbody>
																<apex:repeat value="{!m.Modules}" var="m1">
																	<tr>
																		<td class="m-td-title"><div class="b-title">{!m1.Title}</div></td>
																		<td class="m-td-descr">{!m1.Description}</td>
																		<td class="m-td-type">{!m1.Type}</td>

																		<!-- X -->
																		<td class="m-td-assigned">
																			<apex:outputText value="{0,date,MM/dd/yyyy}">
																				<apex:param value="{!m1.AssignDate}" />
																			</apex:outputText>
																		</td>
																		<td class="m-td-status">{!m1.Status}</td>
																		<td class="m-td-progress">{!m1.Progress}</td>
																		<td class="m-td-score">{!m1.Score}</td>
																		<td class="m-td-attempts">{!m1.Attempts}</td>
																		<td class="m-td-completed">
																			<apex:outputText value="{0,date,MM/dd/yyyy}">
																				<apex:param value="{!m1.Completed}" />
																			</apex:outputText>
																		</td>
																		<!-- X -->

																		<td class="m-td-items">1</td>
																		<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!m1.ItemId}-{!TrId}-{!m1.StaticType}-edit_module-null-{!s.Module.ItemId}-{!m.Course.ItemId}&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
																	</tr>
																</apex:repeat>
															</tbody>
														</table>
													</td>
												</tr>
											</apex:repeat>
											<apex:repeat value="{!s.Modules}" var="m">
												<tr>
													<td class="m-td-title"><div class="b-title">{!m.Title}</div></td>
													<td class="m-td-descr">{!m.Description}</td>
													<td class="m-td-type">{!m.Type}</td>

													<!-- X -->
													<td class="m-td-assigned">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.AssignDate}" />
														</apex:outputText>
													</td>
													<td class="m-td-status">{!m.Status}</td>
													<td class="m-td-progress">{!m.Progress}</td>
													<td class="m-td-score">{!m.Score}</td>
													<td class="m-td-attempts">{!m.Attempts}</td>
													<td class="m-td-completed">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.Completed}" />
														</apex:outputText>
													</td>
													<!-- X -->

													<td class="m-td-items">1</td>
													<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!m.ItemId}-{!TrId}-{!m.StaticType}-edit_module-null-{!s.Module.ItemId}-null&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
												</tr>
											</apex:repeat>
										</tbody>
									</table>
								</td>
							</tr>
						</apex:outputpanel>
						<!-------------------------- CURRICULUM ---------------------------------->
						<apex:outputpanel rendered="{!s.StaticType = OT_CURRICULUM}" layout="none" >
							<tr>
								<td class="m-td-title"><div class="b-title m-plus">{!s.Module.Title}</div></td>
								<td class="m-td-descr">{!s.Module.Description}</td>
								<td class="m-td-type">{!s.Type}</td>

								<!-- X -->
								<td class="m-td-assigned">
									<apex:outputText value="{0,date,MM/dd/yyyy}">
										<apex:param value="{!AssignDate}" />
									</apex:outputText>
								</td>
								<td class="m-td-status">{!Status}</td>
								<td class="m-td-progress">{!Progress}</td>
								<td class="m-td-score">{!Score}</td>
								<td class="m-td-attempts"></td> <!-- for saving layout  -->
								<td class="m-td-completed">
									<apex:outputText value="{0,date,MM/dd/yyyy}">
										<apex:param value="{!Completed}" />
									</apex:outputText>
								</td>
								<!-- X -->

								<td class="m-td-items">{!Items}</td>
								<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!s.Module.ItemId}-{!TrId}-{!s.StaticType}-edit&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
							</tr>
							<tr class="m-hide">
								<td class="b-inner m-level-1" colspan="5">
									<table width="100%" cellspacing="0" cellpadding="0">
										<tbody>
											<apex:repeat value="{!s.Learnpths}" var="m">
												<tr>
													<td class="m-td-title"><div class="b-title m-plus">{!m.LearnPath.Title}</div></td>
													<td class="m-td-descr">{!m.LearnPath.Description}</td>
													<td class="m-td-type">{!m.LearnPath.Type}</td>

													<!-- X -->
													<td class="m-td-assigned">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.LearnPath.AssignDate}" />
														</apex:outputText>
													</td>
													<td class="m-td-status">{!m.LearnPath.Status}</td>
													<td class="m-td-progress">{!m.LearnPath.Progress}</td>
													<td class="m-td-score">{!m.LearnPath.Score}</td>
													<td class="m-td-attempts"></td> <!-- for saving layout  -->
													<td class="m-td-completed">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.LearnPath.Completed}" />
														</apex:outputText>
													</td>
													<!-- X -->

													<td class="m-td-items">{!m.Courses.size}</td>
													<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!m.LearnPath.ItemId}-{!TrId}-{!m.LearnPath.StaticType}-edit&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
												</tr>
												<tr class="m-hide">
													<td class="b-inner m-level-2" colspan="5">
														<table width="100%" cellspacing="0" cellpadding="0">
															<tbody>
																<apex:repeat value="{!m.Courses}" var="m1">
																	<tr>
																		<td class="m-td-title"><div class="b-title m-plus">{!m1.Course.Title}</div></td>
																		<td class="m-td-descr">{!m1.Course.Description}</td>
																		<td class="m-td-type">{!m1.Course.Type}</td>

																		<!-- X -->
																		<td class="m-td-assigned">
																			<apex:outputText value="{0,date,MM/dd/yyyy}">
																				<apex:param value="{!m1.Course.AssignDate}" />
																			</apex:outputText>
																		</td>
																		<td class="m-td-status">{!m1.Course.Status}</td>
																		<td class="m-td-progress">{!m1.Course.Progress}</td>
																		<td class="m-td-score">{!m1.Course.Score}</td>
																		<td class="m-td-attempts"></td> <!-- for saving layout  -->
																		<td class="m-td-completed">
																			<apex:outputText value="{0,date,MM/dd/yyyy}">
																				<apex:param value="{!m1.Course.Completed}" />
																			</apex:outputText>
																		</td>
																		<!-- X -->

																		<td class="m-td-items">1</td>
																		<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!m1.Course.ItemId}-{!TrId}-{!m1.Course.StaticType}-edit&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
																	</tr>
																	<tr class="m-hide">
																		<td class="b-inner m-level-3" colspan="5">
																			<table width="100%" cellspacing="0" cellpadding="0">
																				<tbody>
																					<apex:repeat value="{!m1.Modules}" var="m2">
																						<tr>
																							<td class="m-td-title"><div class="b-title">{!m2.Title}</div></td>
																							<td class="m-td-descr">{!m2.Description}</td>
																							<td class="m-td-type">{!m2.Type}</td>

																							<!-- X -->
																							<td class="m-td-assigned">
																								<apex:outputText value="{0,date,MM/dd/yyyy}">
																									<apex:param value="{!m2.AssignDate}" />
																								</apex:outputText>
																							</td>
																							<td class="m-td-status">{!m2.Status}</td>
																							<td class="m-td-progress">{!m2.Progress}</td>
																							<td class="m-td-score">{!m2.Score}</td>
																							<td class="m-td-attempts">{!m2.Attempts}</td>
																							<td class="m-td-completed">
																								<apex:outputText value="{0,date,MM/dd/yyyy}">
																									<apex:param value="{!m2.Completed}" />
																								</apex:outputText>
																							</td>
																							<!-- X -->

																							<td class="m-td-items">1</td>
																							<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!m2.ItemId}-{!TrId}-{!m2.StaticType}-edit_module-{!s.Module.ItemId}-{!m.LearnPath.ItemId}-{!m1.Course.ItemId}&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
																						</tr>
																					</apex:repeat>
																				</tbody>
																			</table>
																		</td>
																	</tr>
																</apex:repeat>
																<apex:repeat value="{!m.Modules}" var="m3">
																	<tr>
																		<td class="m-td-title"><div class="b-title">{!m3.Title}</div></td>
																		<td class="m-td-descr">{!m3.Description}</td>
																		<td class="m-td-type">{!m3.Type}</td>

																		<!-- X -->
																		<td class="m-td-assigned">
																			<apex:outputText value="{0,date,MM/dd/yyyy}">
																				<apex:param value="{!m3.AssignDate}" />
																			</apex:outputText>
																		</td>
																		<td class="m-td-status">{!m3.Status}</td>
																		<td class="m-td-progress">{!m3.Progress}</td>
																		<td class="m-td-score">{!m3.Score}</td>
																		<td class="m-td-attempts">{!m3.Attempts}</td>
																		<td class="m-td-completed">
																			<apex:outputText value="{0,date,MM/dd/yyyy}">
																				<apex:param value="{!m3.Completed}" />
																			</apex:outputText>
																		</td>
																		<!-- X -->

																		<td class="m-td-items">1</td>
																		<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!m3.ItemId}-{!TrId}-{!m3.StaticType}-edit_module-{!s.Module.ItemId}-{!m.LearnPath.ItemId}-null&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
																	</tr>
																</apex:repeat>
															</tbody>
														</table>
													</td>
												</tr>
											</apex:repeat>
											<apex:repeat value="{!s.Courses}" var="m">
												<tr>
													<td class="m-td-title"><div class="b-title m-plus">{!m.Course.Title}</div></td>
													<td class="m-td-descr">{!m.Course.Description}</td>
													<td class="m-td-type">{!m.Course.Type}</td>

													<!-- X -->
													<td class="m-td-assigned">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.Course.AssignDate}" />
														</apex:outputText>
													</td>
													<td class="m-td-status">{!m.Course.Status}</td>
													<td class="m-td-progress">{!m.Course.Progress}</td>
													<td class="m-td-score">{!m.Course.Score}</td>
													<td class="m-td-attempts"></td> <!-- for saving layout  -->
													<td class="m-td-completed">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.Course.Completed}" />
														</apex:outputText>
													</td>
													<!-- X -->

													<td class="m-td-items">{!m.Modules.size}</td>
													<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!m.Course.ItemId}-{!TrId}-{!m.Course.StaticType}-edit&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
												</tr>
												<tr class="m-hide">
													<td class="b-inner m-level-2" colspan="5">
														<table width="100%" cellspacing="0" cellpadding="0">
															<tbody>
																<apex:repeat value="{!m.Modules}" var="m1">
																	<tr>
																		<td class="m-td-title"><div class="b-title">{!m1.Title}</div></td>
																		<td class="m-td-descr">{!m1.Description}</td>
																		<td class="m-td-type">{!m1.Type}</td>

																		<!-- X -->
																		<td class="m-td-assigned">
																			<apex:outputText value="{0,date,MM/dd/yyyy}">
																				<apex:param value="{!m1.AssignDate}" />
																			</apex:outputText>
																		</td>
																		<td class="m-td-status">{!m1.Status}</td>
																		<td class="m-td-progress">{!m1.Progress}</td>
																		<td class="m-td-score">{!m1.Score}</td>
																		<td class="m-td-attempts">{!m1.Attempts}</td>
																		<td class="m-td-completed">
																			<apex:outputText value="{0,date,MM/dd/yyyy}">
																				<apex:param value="{!m1.Completed}" />
																			</apex:outputText>
																		</td>
																		<!-- X -->

																		<td class="m-td-items">1</td>
																		<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!m1.ItemId}-{!TrId}-{!m1.StaticType}-edit_module-{!s.Module.ItemId}-null-{!m.Course.ItemId}&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
																	</tr>
																</apex:repeat>
															</tbody>
														</table>
													</td>
												</tr>
											</apex:repeat>
											<apex:repeat value="{!s.Modules}" var="m">
												<tr>
													<td class="m-td-title"><div class="b-title">{!m.Title}</div></td>
													<td class="m-td-descr">{!m.Description}</td>
													<td class="m-td-type">{!m.Type}</td>

													<!-- X -->
													<td class="m-td-assigned">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.AssignDate}" />
														</apex:outputText>
													</td>
													<td class="m-td-status">{!m.Status}</td>
													<td class="m-td-progress">{!m.Progress}</td>
													<td class="m-td-score">{!m.Score}</td>
													<td class="m-td-attempts">{!m.Attempts}</td>
													<td class="m-td-completed">
														<apex:outputText value="{0,date,MM/dd/yyyy}">
															<apex:param value="{!m.Completed}" />
														</apex:outputText>
													</td>
													<!-- X -->

													<td class="m-td-items">1</td>
													<td class="m-td-btns"><a href="{!$Page.ListAssignments}?content_id={!m.ItemId}-{!TrId}-{!m.StaticType}-edit_module-{!s.Module.ItemId}-null-null&retURL={!$CurrentPage.URL}" class="b-btn">{!$Label.Edit}</a></td>
												</tr>
											</apex:repeat>
										</tbody>
									</table>
								</td>
							</tr>
						</apex:outputpanel>
					</apex:repeat>
				</tbody>
			</table>
		</div>
	</apex:outputpanel>
</apex:pageBlock>

<apex:pageBlock title="{!$Label.Assignment_List_Assignments}" id="Edit_block" rendered="{!PageNum = 200}">
	<apex:pageBlockTable value="{!AssignmentsForEdit}" var="a" cellPadding="4" border="1">
		<apex:column >
			<apex:facet name="header">{!$Label.Action}</apex:facet>
			<apex:outputLink value="/{!a.Id}/e?inline=1&retURL={!$CurrentPage.URL}">{!$Label.Edit}</apex:outputLink>
		</apex:column>
		<apex:column >
			<apex:facet name="header">Module Title</apex:facet>
			<apex:outputText value="{!a.lmscons__Content_Title__c}" />
		</apex:column>
		<apex:column >
			<apex:facet name="header">{!$Label.SearchCatalog_Trainees}</apex:facet>
			<apex:outputText value="{!a.lmscons__Trainee__c}" />
		</apex:column>
		<apex:column >
			<apex:facet name="header">{!$Label.Assignments_Status}</apex:facet>
			<apex:outputText value="{!a.lmscons__Status__c}" />
		</apex:column>
		<apex:column >
			<apex:facet name="header">{!$Label.Registration_Status}</apex:facet>
			<apex:outputText value="{!a.lmscons__Registration_Status__c}" />
		</apex:column>
		<apex:column >
			<apex:facet name="header">{!$Label.Assignments_Progress}</apex:facet>
			<apex:outputText value="{!a.lmscons__Progress__c}" />
		</apex:column>
		<apex:column >
			<apex:facet name="header">{!$Label.MyTraining_Column4}</apex:facet>
			<apex:outputText value="{!a.lmscons__Score__c}" />
		</apex:column>

	</apex:pageBlockTable>
</apex:pageBlock>

<apex:actionFunction action="{!Refresh_Page}" name="refresh_page" rerender="assign_block" status="search_status" />

<apex:actionFunction name="SortCol" action="{!SortCol}"  status="search_status" reRender="assign_block">
	<apex:param name="snd1" value="" assignTo="{!SortColumnNumber}"/>
</apex:actionFunction>

<apex:outputpanel layout="none" id="formdraw">
	<div id="dialog-modal" title="{!$label.Details}" style="display:none;">
	</div>
</apex:outputpanel>

<apex:pageBlock title="{!$Label.Assignment_List_Assignments}" id="assign_block" rendered="{!PageNum = 1}">
	<apex:pageBlockSection id="filter" columns="7" title="{!$Label.Assignment_List_Filter}">
		<apex:pageBlockSectionItem labelStyle="padding-right: 5px;" dataStyle="padding-right: 0px; padding-left: 0px;">
			<apex:outputLabel value="{!$Label.Assignment_List_Trainee}" style="text-align:left;" />
			<apex:selectList value="{!UserTypeValue}" multiselect="false" size="1">
				<apex:selectOptions value="{!UserType}"/>
			</apex:selectList>
		</apex:pageBlockSectionItem>
		<apex:pageBlockSectionItem dataStyle="padding-right: 5px;">
			<apex:inputText required="false" size="20" value="{!Trainee}" onkeypress="return runScript(event)"/>
		</apex:pageBlockSectionItem>
		<apex:pageBlockSectionItem labelStyle="padding-right: 5px;" dataStyle="padding-right: 10px; padding-left: 0px;">
			<apex:outputLabel value="{!$Label.Assignment_List_Learning}" />
			<apex:inputText value="{!Learning}" size="15" onkeypress="return runScript(event)"/>
		</apex:pageBlockSectionItem>
		<apex:pageBlockSectionItem dataStyle="padding-right: 10px; padding-left: 0px;" labelStyle="padding-right: 5px; padding-left: 0px;">
			<apex:outputLabel value="{!$Label.Assignment_List_Assigned_from}" Style="padding-right: 0px;" />
			<apex:inputField value="{!DteLookup.lmscons__Completed_Date__c}"  />
		</apex:pageBlockSectionItem>
		<apex:pageBlockSectionItem dataStyle="padding-right: 10px;">
			<apex:outputLabel value="{!$Label.Assignment_List_Assigned_to}" />
			<apex:inputField value="{!DteLookup.lmscons__Due_Date__c}" />
		</apex:pageBlockSectionItem>
		<apex:pageBlockSectionItem dataStyle="padding-right: 10px;">
			<apex:outputLabel value="{!$Label.Assignment_List_Show_Historical}" />
			<apex:inputCheckbox value="{!showHistorical}" />
		</apex:pageBlockSectionItem>
		<apex:pageBlockSectionItem dataStyle="padding-right: 0px; padding-left: 0px;" labelStyle="padding-right: 0px; padding-left: 0px;">
			<apex:commandButton action="{!SearchAssignments}" rerender="assign_block, messages" status="search_status" value="Search" id="searchbutton"/>
			<apex:outputpanel layout="inline" style="position:relative; left:-20px; width: 20px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<apex:actionStatus id="search_status">
					<apex:facet name="start">
						<apex:image url="/img/loading.gif" />
					</apex:facet>
				</apex:actionStatus>
			</apex:outputpanel>
		</apex:pageBlockSectionItem>
	</apex:pageBlockSection>

	<apex:outputLabel value="{!$Label.Assignment_List_No_records}" rendered="{!FirstSearch == false && AsgList.size == 0}" />

	<apex:pageBlockTable value="{!AsgList}" var="a" cellPadding="0" border="1" rendered="{!AsgList.size > 0}">
		<apex:column >
			<apex:facet name="header">{!$Label.Action}</apex:facet>
			<span style="float: left; width: 35px;">
				<apex:outputLink rendered="{!NOT(CONTAINS(OT_LOW_LEVEL_SET, a.StaticType))}" value="Javascript:open_popup('{!a.Id}','{!a.TraineeId}','{!a.StaticType}','edit')">{!$Label.Edit}</apex:outputLink>
				<apex:outputLink rendered="{!CONTAINS(OT_LOW_LEVEL_SET, a.StaticType)}" value="Javascript:open_popup('{!a.AssignmentId}','{!a.TraineeId}','{!a.StaticType}','edit')">{!$Label.Edit}</apex:outputLink>
				&nbsp;&nbsp;
			</span>
			<span style="float: left; width: 50px;">
				<apex:outputLink rendered="{!NOT(CONTAINS(OT_LOW_LEVEL_SET, a.StaticType))}" value="Javascript:open_popup('{!a.Id}','{!a.TraineeId}','{!a.StaticType}','details')">{!$Label.Details}</apex:outputLink>
				&nbsp;&nbsp;
			</span>
			<span style="float: left; width: 35px;">
				<apex:commandLink action="{!RemoveEntity}" onclick="return confirm('{!(IF(AND(a.isLowLevel,NOT(a.isHistorical)),JSENCODE($Label.Assignment_List_Hide_Message),JSENCODE($Label.Assignment_List_Del_Message)))}')" value="{!IF(showHistorical,$Label.List_Assignments_Del,$Label.List_Assignments_Archive )}" status="search_status">
					<apex:param name="var1" value="{!a.Id}" assignTo="{!EntityId}"/>
					<apex:param name="var2" value="{!a.TraineeId}" assignTo="{!TraineeId}"/>
					<apex:param name="var3" value="{!a.StaticType}" assignTo="{!Type}"/>
				</apex:commandLink>
			</span>
			<apex:outputpanel style="float: left; width: 35px;">
			</apex:outputpanel>
		</apex:column>

		<apex:column >
			<apex:facet name="header">
				<apex:outputLink value="JavaScript:SortCol('8');">
					{!$Label.Assignments_Assigned}
					<apex:image url="/s.gif" styleclass="{!IF(AscDesc = false, 'sortAsc', 'sortDesc')}" rendered="{!SortColumnNumber = '8'}" />
				</apex:outputLink>
			</apex:facet>
			<c:LocaleFormattedDate DateValue="{!a.AssignDate}"></c:LocaleFormattedDate>
		</apex:column>

		<apex:column >
			<apex:facet name="header">
				<apex:outputLink value="JavaScript:SortCol('1');">
					{!$Label.Assignments_Title}
					<apex:image url="/s.gif" styleclass="{!IF(AscDesc = false, 'sortAsc', 'sortDesc')}" rendered="{!SortColumnNumber = '1'}" />
				</apex:outputLink>
			</apex:facet>
			{!a.Title}
		</apex:column>

		<apex:column >
			<apex:facet name="header">
				<apex:outputLink value="JavaScript:SortCol('2');">
					{!$Label.Assignments_Type}
					<apex:image url="/s.gif" styleclass="{!IF(AscDesc = false, 'sortAsc', 'sortDesc')}" rendered="{!SortColumnNumber = '2'}" />
				</apex:outputLink>
			</apex:facet>
			{!a.Type}
		</apex:column>

		<apex:column >
			<apex:facet name="header">
				<apex:outputLink value="JavaScript:SortCol('3');">
					{!$Label.Assignment_List_Trainee}
					<apex:image url="/s.gif" styleclass="{!IF(AscDesc = false, 'sortAsc', 'sortDesc')}" rendered="{!SortColumnNumber = '3'}" />
				</apex:outputLink>
			</apex:facet>
			{!a.Trainee}
		</apex:column>

		<apex:column >
			<apex:facet name="header">
				<apex:outputLink value="JavaScript:SortCol('4');">
					{!$Label.Assignments_Status}
					<apex:image url="/s.gif" styleclass="{!IF(AscDesc = false, 'sortAsc', 'sortDesc')}" rendered="{!SortColumnNumber = '4'}" />
				</apex:outputLink>
			</apex:facet>
			{!a.Status}
		</apex:column>

		<apex:column >
			<apex:facet name="header">
				<apex:outputLink value="JavaScript:SortCol('5');">
					{!$Label.MyTraining_Column2}
					<apex:image url="/s.gif" styleclass="{!IF(AscDesc = false, 'sortAsc', 'sortDesc')}" rendered="{!SortColumnNumber = '5'}" />
				</apex:outputLink>
			</apex:facet>
			{!a.Progress}
		</apex:column>

		<apex:column >
			<apex:facet name="header">
				<apex:outputLink value="JavaScript:SortCol('6');">
					{!$Label.Assignments_Score}
					<apex:image url="/s.gif" styleclass="{!IF(AscDesc = false, 'sortAsc', 'sortDesc')}" rendered="{!SortColumnNumber = '6'}" />
				</apex:outputLink>
			</apex:facet>
			{!a.Score}
		</apex:column>

		<apex:column headerClass="centerAlign" styleClass="centerAlign">
			<apex:facet name="header">

					{!$Label.Attempts}

			</apex:facet>
			{!a.attempts}
		</apex:column>

		<apex:column >
			<apex:facet name="header">
				<apex:outputLink value="JavaScript:SortCol('7');">
					{!$Label.Assignments_Completed}
					<apex:image url="/s.gif" styleclass="{!IF(AscDesc = false, 'sortAsc', 'sortDesc')}" rendered="{!SortColumnNumber = '7'}" />
				</apex:outputLink>
			</apex:facet>
			<c:LocaleFormattedDate DateValue="{!a.Completed}"></c:LocaleFormattedDate>
		</apex:column>
	</apex:pageBlockTable>

	<apex:outputText rendered="{!Pages.size != 0 && Pages.size > 1}">{!$label.MyTeam_Page}: &nbsp;&nbsp;</apex:outputText>

	<apex:repeat value="{!Pages}" var="p" rendered="{!Pages.size > 1}">
		<apex:commandLink value="{!p}" rendered="{!CurrentPage != p}" action="{!BuildAssignmentsList}" rerender="assign_block, messages" status="search_status">
			<apex:param value="{!p}" assignTo="{!CurrentPage}" name="var1"/>
		</apex:commandLink>
		<apex:outputText rendered="{!CurrentPage = p}"><b>{!p}</b></apex:outputText>
		&nbsp;&nbsp;
	</apex:repeat>

</apex:pageBlock>

</apex:form>
</body>
</html>
</apex:page>